
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://prophetverse.com/0.7.0/mmm/fitting_and_calibration/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../budget_allocation/">
      
      
      <link rel="icon" href="../../static/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>Saturation, Calibration, and Unified Marketing Measurement - Prophetverse</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="https://unpkg.com/katex@0/dist/katex.min">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../ipymd/pandas.css">
    
      <link rel="stylesheet" href="../../ipymd/cell-style.css">
    
      <link rel="stylesheet" href="../../ipymd/pygments.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#prophetverse-marketing-mix-modeling" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Prophetverse" class="md-header__button md-logo" aria-label="Prophetverse" data-md-component="logo">
      
  <img src="../../static/logo-removebg.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Prophetverse
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Saturation, Calibration, and Unified Marketing Measurement
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/felipeangelimvieira/prophetverse" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tutorial/univariate/" class="md-tabs__link">
          
  
  
  Tutorial üìö

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../howto/" class="md-tabs__link">
          
  
  
  How-to üõ†Ô∏è

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
  Marketing Mix Modeling üöÄ

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../the-theory/" class="md-tabs__link">
          
  
  
  Mathematical formulation üìñ

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../reference/sktime/prophetverse/" class="md-tabs__link">
          
  
  
  Reference

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../development/development-guide/" class="md-tabs__link">
          
  
  
  Development

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../deprecation/" class="md-tabs__link">
        
  
  
    
  
  Deprecation Policy

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Prophetverse" class="md-nav__button md-logo" aria-label="Prophetverse" data-md-component="logo">
      
  <img src="../../static/logo-removebg.png" alt="logo">

    </a>
    Prophetverse
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/felipeangelimvieira/prophetverse" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tutorial üìö
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tutorial üìö
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/univariate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Univariate Time Series
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/hierarchical/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hierarchical Time Series
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/count-data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Nonnegative timeseries
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/tuning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hyperparameter tuning
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    How-to üõ†Ô∏è
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            How-to üõ†Ô∏è
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/custom-effects/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Custom Exogenous Effects ‚ú®
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/custom-trend/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Custom Trend üåü
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/composite-exogenous-effects/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Composite Exogenous Effects
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Marketing Mix Modeling üöÄ
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Marketing Mix Modeling üöÄ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Saturation, Calibration, and Unified Marketing Measurement
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Saturation, Calibration, and Unified Marketing Measurement
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#forecasting-calibration-and-unified-marketing-measurement" class="md-nav__link">
    <span class="md-ellipsis">
      Forecasting, Calibration, and Unified Marketing Measurement
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-1-forecasting-with-adstock-saturation-effects" class="md-nav__link">
    <span class="md-ellipsis">
      Part 1: Forecasting with Adstock &amp; Saturation Effects
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 1: Forecasting with Adstock &amp; Saturation Effects">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-this-matters" class="md-nav__link">
    <span class="md-ellipsis">
      üîé Why this matters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11-component-level-diagnostics" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 Component-Level Diagnostics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-backtesting-with-cross-validation" class="md-nav__link">
    <span class="md-ellipsis">
      1.2 Backtesting with Cross-Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-saturation-curves" class="md-nav__link">
    <span class="md-ellipsis">
      1.3 Saturation Curves
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-2-calibration-with-causal-evidence" class="md-nav__link">
    <span class="md-ellipsis">
      Part 2: Calibration with Causal Evidence
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Part 2: Calibration with Causal Evidence">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-visualizing-lift-tests" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 Visualizing Lift Tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-improve-estimates-via-liftexperimentlikelihood" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 Improve Estimates via LiftExperimentLikelihood
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-add-attribution-signals-with-exactlikelihood" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 Add Attribution Signals with ExactLikelihood
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#final-thoughts-toward-unified-marketing-measurement" class="md-nav__link">
    <span class="md-ellipsis">
      Final Thoughts: Toward Unified Marketing Measurement
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../budget_allocation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Budget Optimization
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Mathematical formulation üìñ
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Mathematical formulation üìñ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../the-theory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Theory
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" >
        
          
          <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Sktime
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1">
            <span class="md-nav__icon md-icon"></span>
            Sktime
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/sktime/prophetverse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prophetverse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/sktime/prophet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prophet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/sktime/prophet_gamma/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ProphetGamma
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/sktime/prophet_negbin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ProphetNegBinomial
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/sktime/hierarchical_prophet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hierarchical Prophet
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/inference_engine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Inference Engines
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/optimizers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Optimizers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/effects/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exogenous Effects
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/trends/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trend models
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Development
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/development-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing to Prophetverse
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../deprecation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deprecation Policy
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="prophetverse-marketing-mix-modeling">Prophetverse Marketing Mix Modeling:</h1>
<h2 id="forecasting-calibration-and-unified-marketing-measurement">Forecasting, Calibration, and Unified Marketing Measurement</h2>
<p>In this tutorial, we walk through the lifecycle of a modern Marketing Mix Model (MMM),
from time-series forecasting to incorporating causal evidence like lift tests and attribution.</p>
<p>You will learn:</p>
<ol>
<li>
<p>How to <strong>forecast</strong> revenue using media spend with Adstock and Saturation effects.</p>
</li>
<li>
<p>How to <strong>diagnose model behavior</strong> and evaluate with backtesting.</p>
</li>
<li>
<p>Why <strong>correlated spend channels</strong> confuse effect estimation‚Äîand how to fix it.</p>
</li>
<li>
<p>How to <strong>calibrate</strong> your model using <strong>lift tests</strong> and <strong>attribution models</strong> for better ROI measurement.</p>
</li>
</ol>
<p>üëâ <strong>Why this matters</strong>: MMMs are foundational for budget allocation. But good predictions are not enough‚Äî
we need <strong>credible effect estimates</strong> to make real-world decisions.</p>
<p>Let‚Äôs get started!</p>
<p>Setting up some libraries, float64 precision,
and plot style.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpyro</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpyro.distributions</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">dist</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;seaborn-v0_8-whitegrid&quot;</span><span class="p">)</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="n">numpyro</span><span class="o">.</span><span class="n">enable_x64</span><span class="p">()</span>  <span class="c1"># Necessary for precision in numerical optimization</span>
</span></code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">prophetverse.datasets._mmm.dataset1</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_dataset</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="c1"># Load synthetic data</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="c1"># This lets us compare model output with known ‚Äútrue‚Äù components</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">lift_tests</span><span class="p">,</span> <span class="n">true_components</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_dataset</span><span class="p">()</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="n">lift_test1</span><span class="p">,</span> <span class="n">lift_test2</span> <span class="o">=</span> <span class="n">lift_tests</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;y shape: </span><span class="si">{</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, X shape: </span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="n">X</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></code></pre></div>
<p class="cell-output-title jp-RenderedText jp-OutputArea-output">Output: <span class="cell-output-count">[2]</span></p>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ad_spend_search</th>
      <th>ad_spend_social_media</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-01-01</th>
      <td>89076.191178</td>
      <td>98587.488958</td>
    </tr>
    <tr>
      <th>2000-01-02</th>
      <td>88891.993106</td>
      <td>99066.321168</td>
    </tr>
    <tr>
      <th>2000-01-03</th>
      <td>89784.955064</td>
      <td>97334.106903</td>
    </tr>
    <tr>
      <th>2000-01-04</th>
      <td>89931.220681</td>
      <td>101747.300585</td>
    </tr>
    <tr>
      <th>2000-01-05</th>
      <td>89184.319596</td>
      <td>93825.221809</td>
    </tr>
  </tbody>
</table>
</div>

<hr />
<h2 id="part-1-forecasting-with-adstock-saturation-effects">Part 1: Forecasting with Adstock &amp; Saturation Effects</h2>
<p>Here we‚Äôll build a <strong>time-series forecasting model</strong> that includes:</p>
<ul>
<li>
<p><strong>Trend</strong> and <strong>seasonality</strong></p>
</li>
<li>
<p><strong>Lagged media effects</strong> (Adstock)</p>
</li>
<li>
<p><strong>Diminishing returns</strong> (Saturation / Hill curves)</p>
</li>
</ul>
<h3 id="why-this-matters">üîé Why this matters:</h3>
<p>Raw spend is <strong>not immediately effective</strong>, and it <strong>doesn‚Äôt convert linearly</strong>.
Capturing these dynamics is essential to make ROI estimates realistic.</p>
<p>In Prophetverse, we define the model as triplets of:</p>
<ul>
<li>
<p><strong>Effect name</strong>: e.g. <code>ad_spend_search</code></p>
</li>
<li>
<p><strong>Effect object</strong>: e.g. <code>HillEffect()</code></p>
</li>
<li>
<p><strong>Input columns</strong>: columns from <code>X</code> that should be passed to the effect. We
use <code>None</code> when the effect is not directly driven by input columns, and a regex
to query multiple columns when the effect is driven by multiple inputs, e.g.
<code>"ad_spend_.*"</code>, <code>"holidays_*"</code>.</p>
</li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">prophetverse.effects</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    <span class="n">PiecewiseLinearTrend</span><span class="p">,</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>    <span class="n">LinearFourierSeasonality</span><span class="p">,</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    <span class="n">ChainedEffects</span><span class="p">,</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>    <span class="n">GeometricAdstockEffect</span><span class="p">,</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    <span class="n">HillEffect</span><span class="p">,</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="p">)</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">prophetverse.sktime</span><span class="w"> </span><span class="kn">import</span> <span class="n">Prophetverse</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="kn">from</span><span class="w"> </span><span class="nn">prophetverse.engine</span><span class="w"> </span><span class="kn">import</span> <span class="n">MAPInferenceEngine</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">prophetverse.engine.optimizer</span><span class="w"> </span><span class="kn">import</span> <span class="n">LBFGSSolver</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="c1"># Seasonal patterns</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="n">yearly</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>    <span class="s2">&quot;yearly_seasonality&quot;</span><span class="p">,</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>    <span class="n">LinearFourierSeasonality</span><span class="p">(</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>        <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>        <span class="n">sp_list</span><span class="o">=</span><span class="p">[</span><span class="mf">365.25</span><span class="p">],</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>        <span class="n">fourier_terms_list</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>        <span class="n">prior_scale</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>        <span class="n">effect_mode</span><span class="o">=</span><span class="s2">&quot;multiplicative&quot;</span><span class="p">,</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>    <span class="p">),</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>    <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="p">)</span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="n">weekly</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>    <span class="s2">&quot;weekly_seasonality&quot;</span><span class="p">,</span>
</span><span id="__span-2-26"><a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>    <span class="n">LinearFourierSeasonality</span><span class="p">(</span>
</span><span id="__span-2-27"><a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a>        <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">,</span>
</span><span id="__span-2-28"><a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a>        <span class="n">sp_list</span><span class="o">=</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span>
</span><span id="__span-2-29"><a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a>        <span class="n">fourier_terms_list</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
</span><span id="__span-2-30"><a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a>        <span class="n">prior_scale</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
</span><span id="__span-2-31"><a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a>        <span class="n">effect_mode</span><span class="o">=</span><span class="s2">&quot;multiplicative&quot;</span><span class="p">,</span>
</span><span id="__span-2-32"><a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a>    <span class="p">),</span>
</span><span id="__span-2-33"><a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a>    <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-2-34"><a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a><span class="p">)</span>
</span><span id="__span-2-35"><a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a>
</span><span id="__span-2-36"><a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a><span class="c1"># Chain Adstock and Saturation for each channel</span>
</span><span id="__span-2-37"><a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a><span class="n">hill</span> <span class="o">=</span> <span class="n">HillEffect</span><span class="p">(</span>
</span><span id="__span-2-38"><a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a>    <span class="n">half_max_prior</span><span class="o">=</span><span class="n">dist</span><span class="o">.</span><span class="n">HalfNormal</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
</span><span id="__span-2-39"><a id="__codelineno-2-39" name="__codelineno-2-39" href="#__codelineno-2-39"></a>    <span class="n">slope_prior</span><span class="o">=</span><span class="n">dist</span><span class="o">.</span><span class="n">InverseGamma</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="__span-2-40"><a id="__codelineno-2-40" name="__codelineno-2-40" href="#__codelineno-2-40"></a>    <span class="n">max_effect_prior</span><span class="o">=</span><span class="n">dist</span><span class="o">.</span><span class="n">HalfNormal</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
</span><span id="__span-2-41"><a id="__codelineno-2-41" name="__codelineno-2-41" href="#__codelineno-2-41"></a>    <span class="n">effect_mode</span><span class="o">=</span><span class="s2">&quot;additive&quot;</span><span class="p">,</span>
</span><span id="__span-2-42"><a id="__codelineno-2-42" name="__codelineno-2-42" href="#__codelineno-2-42"></a>    <span class="n">input_scale</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span>
</span><span id="__span-2-43"><a id="__codelineno-2-43" name="__codelineno-2-43" href="#__codelineno-2-43"></a><span class="p">)</span>
</span><span id="__span-2-44"><a id="__codelineno-2-44" name="__codelineno-2-44" href="#__codelineno-2-44"></a><span class="n">chained_search</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-2-45"><a id="__codelineno-2-45" name="__codelineno-2-45" href="#__codelineno-2-45"></a>    <span class="s2">&quot;ad_spend_search&quot;</span><span class="p">,</span>
</span><span id="__span-2-46"><a id="__codelineno-2-46" name="__codelineno-2-46" href="#__codelineno-2-46"></a>    <span class="n">ChainedEffects</span><span class="p">([(</span><span class="s2">&quot;adstock&quot;</span><span class="p">,</span> <span class="n">GeometricAdstockEffect</span><span class="p">()),</span> <span class="p">(</span><span class="s2">&quot;saturation&quot;</span><span class="p">,</span> <span class="n">hill</span><span class="p">)]),</span>
</span><span id="__span-2-47"><a id="__codelineno-2-47" name="__codelineno-2-47" href="#__codelineno-2-47"></a>    <span class="s2">&quot;ad_spend_search&quot;</span><span class="p">,</span>
</span><span id="__span-2-48"><a id="__codelineno-2-48" name="__codelineno-2-48" href="#__codelineno-2-48"></a><span class="p">)</span>
</span><span id="__span-2-49"><a id="__codelineno-2-49" name="__codelineno-2-49" href="#__codelineno-2-49"></a><span class="n">chained_social</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-2-50"><a id="__codelineno-2-50" name="__codelineno-2-50" href="#__codelineno-2-50"></a>    <span class="s2">&quot;ad_spend_social_media&quot;</span><span class="p">,</span>
</span><span id="__span-2-51"><a id="__codelineno-2-51" name="__codelineno-2-51" href="#__codelineno-2-51"></a>    <span class="n">ChainedEffects</span><span class="p">([(</span><span class="s2">&quot;adstock&quot;</span><span class="p">,</span> <span class="n">GeometricAdstockEffect</span><span class="p">()),</span> <span class="p">(</span><span class="s2">&quot;saturation&quot;</span><span class="p">,</span> <span class="n">hill</span><span class="p">)]),</span>
</span><span id="__span-2-52"><a id="__codelineno-2-52" name="__codelineno-2-52" href="#__codelineno-2-52"></a>    <span class="s2">&quot;ad_spend_social_media&quot;</span><span class="p">,</span>
</span><span id="__span-2-53"><a id="__codelineno-2-53" name="__codelineno-2-53" href="#__codelineno-2-53"></a><span class="p">)</span>
</span></code></pre></div>
<p>We are ready to define our Prophetverse model</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># Prophetverse model with MAP inference</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="n">baseline_model</span> <span class="o">=</span> <span class="n">Prophetverse</span><span class="p">(</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>    <span class="n">trend</span><span class="o">=</span><span class="n">PiecewiseLinearTrend</span><span class="p">(</span><span class="n">changepoint_interval</span><span class="o">=</span><span class="mi">100</span><span class="p">),</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>    <span class="n">exogenous_effects</span><span class="o">=</span><span class="p">[</span><span class="n">yearly</span><span class="p">,</span> <span class="n">weekly</span><span class="p">,</span> <span class="n">chained_search</span><span class="p">,</span> <span class="n">chained_social</span><span class="p">],</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>    <span class="n">inference_engine</span><span class="o">=</span><span class="n">MAPInferenceEngine</span><span class="p">(</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>        <span class="n">num_steps</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>        <span class="n">optimizer</span><span class="o">=</span><span class="n">LBFGSSolver</span><span class="p">(</span><span class="n">memory_size</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">max_linesearch_steps</span><span class="o">=</span><span class="mi">200</span><span class="p">),</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>    <span class="p">),</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="p">)</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="c1"># Fit and predict in-sample</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="n">baseline_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">)</span>
</span></code></pre></div>
<p class="cell-output-title jp-RenderedText jp-OutputArea-output">Output: <span class="cell-output-count">[4]</span></p>

<style>#sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 {
    /* Definition of color scheme common for light and dark mode */
    --sklearn-color-text: black;
    --sklearn-color-line: gray;
    /* Definition of color scheme for objects */
    --sklearn-color-level-0: #fff5e6;
    --sklearn-color-level-1: #f6e4d2;
    --sklearn-color-level-2: #ffe0b3;
    --sklearn-color-level-3: chocolate;

    /* Specific color for light theme */
    --sklearn-color-text-on-default-background: var(--theme-code-foreground, var(--jp-content-font-color1, black));
    --sklearn-color-background: var(--theme-background, var(--jp-layout-color0, white));
    --sklearn-color-border-box: var(--theme-code-foreground, var(--jp-content-font-color1, black));
    --sklearn-color-icon: #696969;

    @media (prefers-color-scheme: dark) {
      /* Redefinition of color scheme for dark theme */
      --sklearn-color-text-on-default-background: var(--theme-code-foreground, var(--jp-content-font-color1, white));
      --sklearn-color-background: var(--theme-background, var(--jp-layout-color0, #111));
      --sklearn-color-border-box: var(--theme-code-foreground, var(--jp-content-font-color1, white));
      --sklearn-color-icon: #878787;
    }
  }

  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 {
    color: var(--sklearn-color-text);
  }

  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 pre {
    padding: 0;
  }

  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 input.sk-hidden--visually {
    border: 0;
    clip: rect(1px 1px 1px 1px);
    clip: rect(1px, 1px, 1px, 1px);
    height: 1px;
    margin: -1px;
    overflow: hidden;
    padding: 0;
    position: absolute;
    width: 1px;
  }

  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 div.sk-dashed-wrapped {
    border: 1px dashed var(--sklearn-color-line);
    margin: 0 0.4em 0.5em 0.4em;
    box-sizing: border-box;
    padding-bottom: 0.4em;
    background-color: var(--sklearn-color-background);
  }

  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 div.sk-container {
    /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
       but bootstrap.min.css set `[hidden] { display: none !important; }`
       so we also need the `!important` here to be able to override the
       default hidden behavior on the sphinx rendered scikit-learn.org.
       See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
    display: inline-block !important;
    position: relative;
  }

  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 div.sk-text-repr-fallback {
    display: none;
  }

  div.sk-parallel-item,
  div.sk-serial,
  div.sk-item {
    /* draw centered vertical line to link estimators */
    background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
    background-size: 2px 100%;
    background-repeat: no-repeat;
    background-position: center center;
  }

  /* Parallel-specific style estimator block */

  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 div.sk-parallel-item::after {
    content: "";
    width: 100%;
    border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
    flex-grow: 1;
  }

  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 div.sk-parallel {
    display: flex;
    align-items: stretch;
    justify-content: center;
    background-color: var(--sklearn-color-background);
    position: relative;
  }

  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 div.sk-parallel-item {
    display: flex;
    flex-direction: column;
  }

  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 div.sk-parallel-item:first-child::after {
    align-self: flex-end;
    width: 50%;
  }

  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 div.sk-parallel-item:last-child::after {
    align-self: flex-start;
    width: 50%;
  }

  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 div.sk-parallel-item:only-child::after {
    width: 0;
  }

  /* Serial-specific style estimator block */

  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 div.sk-serial {
    display: flex;
    flex-direction: column;
    align-items: center;
    background-color: var(--sklearn-color-background);
    padding-right: 1em;
    padding-left: 1em;
  }


  /* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
  clickable and can be expanded/collapsed.
  - Pipeline and ColumnTransformer use this feature and define the default style
  - Estimators will overwrite some part of the style using the `sk-estimator` class
  */

  /* Pipeline and ColumnTransformer style (default) */

  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 div.sk-toggleable {
    /* Default theme specific background. It is overwritten whether we have a
    specific estimator or a Pipeline/ColumnTransformer */
    background-color: var(--sklearn-color-background);
  }

  /* Toggleable label */
  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 label.sk-toggleable__label {
    cursor: pointer;
    display: block;
    width: 100%;
    margin-bottom: 0;
    padding: 0.5em;
    box-sizing: border-box;
    text-align: center;
  }

  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 label.sk-toggleable__label-arrow:before {
    /* Arrow on the left of the label */
    content: "‚ñ∏";
    float: left;
    margin-right: 0.25em;
    color: var(--sklearn-color-icon);
  }

  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 label.sk-toggleable__label-arrow:hover:before {
    color: var(--sklearn-color-text);
  }

  /* Toggleable content - dropdown */

  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 div.sk-toggleable__content {
    max-height: 0;
    max-width: 0;
    overflow: hidden;
    text-align: left;
    background-color: var(--sklearn-color-level-0);
  }

  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 div.sk-toggleable__content pre {
    margin: 0.2em;
    border-radius: 0.25em;
    color: var(--sklearn-color-text);
    background-color: var(--sklearn-color-level-0);
  }

  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 input.sk-toggleable__control:checked~div.sk-toggleable__content {
    /* Expand drop-down */
    max-height: 200px;
    max-width: 100%;
    overflow: auto;
  }

  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
    content: "‚ñæ";
  }

  /* Pipeline/ColumnTransformer-specific style */

  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
    color: var(--sklearn-color-text);
    background-color: var(--sklearn-color-level-2);
  }

  /* Estimator-specific style */

  /* Colorize estimator box */
  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
    /* unfitted */
    background-color: var(--sklearn-color-level-2);
  }

  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 div.sk-label label.sk-toggleable__label,
  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 div.sk-label label {
    /* The background is the default theme color */
    color: var(--sklearn-color-text-on-default-background);
  }

  /* On hover, darken the color of the background */
  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 div.sk-label:hover label.sk-toggleable__label {
    color: var(--sklearn-color-text);
    background-color: var(--sklearn-color-level-2);
  }

  /* Estimator label */

  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 div.sk-label label {
    font-family: monospace;
    font-weight: bold;
    display: inline-block;
    line-height: 1.2em;
  }

  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 div.sk-label-container {
    text-align: center;
  }

  /* Estimator-specific */
  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 div.sk-estimator {
    font-family: monospace;
    border: 1px dotted var(--sklearn-color-border-box);
    border-radius: 0.25em;
    box-sizing: border-box;
    margin-bottom: 0.5em;
    background-color: var(--sklearn-color-level-0);
  }

  /* on hover */
  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 div.sk-estimator:hover {
    background-color: var(--sklearn-color-level-2);
  }

  /* Specification for estimator info */

  .sk-estimator-doc-link,
  a:link.sk-estimator-doc-link,
  a:visited.sk-estimator-doc-link {
    float: right;
    font-size: smaller;
    line-height: 1em;
    font-family: monospace;
    background-color: var(--sklearn-color-background);
    border-radius: 1em;
    height: 1em;
    width: 1em;
    text-decoration: none !important;
    margin-left: 1ex;
    border: var(--sklearn-color-level-1) 1pt solid;
    color: var(--sklearn-color-level-1);
  }

  /* On hover */
  div.sk-estimator:hover .sk-estimator-doc-link:hover,
  .sk-estimator-doc-link:hover,
  div.sk-label-container:hover .sk-estimator-doc-link:hover,
  .sk-estimator-doc-link:hover {
    background-color: var(--sklearn-color-level-3);
    color: var(--sklearn-color-background);
    text-decoration: none;
  }

  /* Span, style for the box shown on hovering the info icon */
  .sk-estimator-doc-link span {
    display: none;
    z-index: 9999;
    position: relative;
    font-weight: normal;
    right: .2ex;
    padding: .5ex;
    margin: .5ex;
    width: min-content;
    min-width: 20ex;
    max-width: 50ex;
    color: var(--sklearn-color-text);
    box-shadow: 2pt 2pt 4pt #999;
    background: var(--sklearn-color-level-0);
    border: .5pt solid var(--sklearn-color-level-3);
  }

  .sk-estimator-doc-link:hover span {
    display: block;
  }

  /* "?"-specific style due to the `<a>` HTML tag */

  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 a.estimator_doc_link {
    float: right;
    font-size: 1rem;
    line-height: 1em;
    font-family: monospace;
    background-color: var(--sklearn-color-background);
    border-radius: 1rem;
    height: 1rem;
    width: 1rem;
    text-decoration: none;
    color: var(--sklearn-color-level-1);
    border: var(--sklearn-color-level-1) 1pt solid;
  }

  /* On hover */
  #sk-dba971c3-9518-4fa9-8685-a9a6f1744f21 a.estimator_doc_link:hover {
    background-color: var(--sklearn-color-level-3);
    color: var(--sklearn-color-background);
    text-decoration: none;
  }
</style>
<div id='sk-dba971c3-9518-4fa9-8685-a9a6f1744f21' class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Prophetverse(exogenous_effects=[(&#x27;yearly_seasonality&#x27;,
                                 LinearFourierSeasonality(effect_mode=&#x27;multiplicative&#x27;,
                                                          fourier_terms_list=[5],
                                                          freq=&#x27;D&#x27;,
                                                          prior_scale=0.1,
                                                          sp_list=[365.25]),
                                 None),
                                (&#x27;weekly_seasonality&#x27;,
                                 LinearFourierSeasonality(effect_mode=&#x27;multiplicative&#x27;,
                                                          fourier_terms_list=[3],
                                                          freq=&#x27;D&#x27;,
                                                          prior_scale=0.05,
                                                          sp_list=[7]),
                                 None),
                                (&#x27;ad_spend_search&#x27;,
                                 Chained...
                                                                   max_effect_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x315cee290 with batch shape () and event shape ()&gt;,
                                                                   slope_prior=&lt;numpyro.distributions.continuous.InverseGamma object at 0x31ab02090 with batch shape () and event shape ()&gt;))]),
                                 &#x27;ad_spend_social_media&#x27;)],
             inference_engine=MAPInferenceEngine(num_steps=5000,
                                                 optimizer=LBFGSSolver(max_linesearch_steps=200,
                                                                       memory_size=200)),
             trend=PiecewiseLinearTrend(changepoint_interval=100))</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class='sk-label-container'><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('cbff3261-724e-4cd1-bc91-08ca77890c2d') type="checkbox" ><label for=UUID('cbff3261-724e-4cd1-bc91-08ca77890c2d') class='sk-toggleable__label sk-toggleable__label-arrow'>Prophetverse</label><div class="sk-toggleable__content"><pre>Prophetverse(exogenous_effects=[(&#x27;yearly_seasonality&#x27;,
                                 LinearFourierSeasonality(effect_mode=&#x27;multiplicative&#x27;,
                                                          fourier_terms_list=[5],
                                                          freq=&#x27;D&#x27;,
                                                          prior_scale=0.1,
                                                          sp_list=[365.25]),
                                 None),
                                (&#x27;weekly_seasonality&#x27;,
                                 LinearFourierSeasonality(effect_mode=&#x27;multiplicative&#x27;,
                                                          fourier_terms_list=[3],
                                                          freq=&#x27;D&#x27;,
                                                          prior_scale=0.05,
                                                          sp_list=[7]),
                                 None),
                                (&#x27;ad_spend_search&#x27;,
                                 Chained...
                                                                   max_effect_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x315cee290 with batch shape () and event shape ()&gt;,
                                                                   slope_prior=&lt;numpyro.distributions.continuous.InverseGamma object at 0x31ab02090 with batch shape () and event shape ()&gt;))]),
                                 &#x27;ad_spend_social_media&#x27;)],
             inference_engine=MAPInferenceEngine(num_steps=5000,
                                                 optimizer=LBFGSSolver(max_linesearch_steps=200,
                                                                       memory_size=200)),
             trend=PiecewiseLinearTrend(changepoint_interval=100))</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class='sk-label-container'><div class="sk-label sk-toggleable"><label>effects</label></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class='sk-item'><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('6bc7670f-5f1e-44cf-b0a6-ef7c49fe2e03') type="checkbox" ><label for=UUID('6bc7670f-5f1e-44cf-b0a6-ef7c49fe2e03') class='sk-toggleable__label sk-toggleable__label-arrow'>PiecewiseLinearTrend</label><div class="sk-toggleable__content"><pre>PiecewiseLinearTrend(changepoint_interval=100)</pre></div></div></div><div class='sk-item'><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('67a8bfaf-9f5d-4eba-ac70-3a8fedf997d8') type="checkbox" ><label for=UUID('67a8bfaf-9f5d-4eba-ac70-3a8fedf997d8') class='sk-toggleable__label sk-toggleable__label-arrow'>LinearFourierSeasonality</label><div class="sk-toggleable__content"><pre>LinearFourierSeasonality(effect_mode=&#x27;multiplicative&#x27;, fourier_terms_list=[5],
                         freq=&#x27;D&#x27;, prior_scale=0.1, sp_list=[365.25])</pre></div></div></div><div class='sk-item'><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('065567ed-e8e9-44db-a89d-ffbb58c1ec5b') type="checkbox" ><label for=UUID('065567ed-e8e9-44db-a89d-ffbb58c1ec5b') class='sk-toggleable__label sk-toggleable__label-arrow'>LinearFourierSeasonality</label><div class="sk-toggleable__content"><pre>LinearFourierSeasonality(effect_mode=&#x27;multiplicative&#x27;, fourier_terms_list=[3],
                         freq=&#x27;D&#x27;, prior_scale=0.05, sp_list=[7])</pre></div></div></div><div class="sk-item"><div class='sk-label-container'><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('093d4b57-1ec4-423b-a119-572fcd83e1d4') type="checkbox" ><label for=UUID('093d4b57-1ec4-423b-a119-572fcd83e1d4') class='sk-toggleable__label sk-toggleable__label-arrow'>ad_spend_search</label><div class="sk-toggleable__content"><pre>ChainedEffects(steps=[(&#x27;adstock&#x27;, GeometricAdstockEffect()),
                      (&#x27;saturation&#x27;,
                       HillEffect(effect_mode=&#x27;additive&#x27;,
                                  half_max_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x31a3992d0 with batch shape () and event shape ()&gt;,
                                  input_scale=1000000.0,
                                  max_effect_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x315cee290 with batch shape () and event shape ()&gt;,
                                  slope_prior=&lt;numpyro.distributions.continuous.InverseGamma object at 0x31ab02090 with batch shape () and event shape ()&gt;))])</pre></div></div></div><div class="sk-serial"><div class='sk-item'><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('62a7e753-23d9-4273-992c-c9bc1e20a2b3') type="checkbox" ><label for=UUID('62a7e753-23d9-4273-992c-c9bc1e20a2b3') class='sk-toggleable__label sk-toggleable__label-arrow'>GeometricAdstockEffect</label><div class="sk-toggleable__content"><pre>GeometricAdstockEffect()</pre></div></div></div><div class='sk-item'><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('87bc156b-7218-42f0-9998-94ac5436f915') type="checkbox" ><label for=UUID('87bc156b-7218-42f0-9998-94ac5436f915') class='sk-toggleable__label sk-toggleable__label-arrow'>HillEffect</label><div class="sk-toggleable__content"><pre>HillEffect(effect_mode=&#x27;additive&#x27;,
           half_max_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x31a3992d0 with batch shape () and event shape ()&gt;,
           input_scale=1000000.0,
           max_effect_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x315cee290 with batch shape () and event shape ()&gt;,
           slope_prior=&lt;numpyro.distributions.continuous.InverseGamma object at 0x31ab02090 with batch shape () and event shape ()&gt;)</pre></div></div></div></div></div><div class="sk-item"><div class='sk-label-container'><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('ebea26f1-61a8-4743-8594-7e3e77e8eaaf') type="checkbox" ><label for=UUID('ebea26f1-61a8-4743-8594-7e3e77e8eaaf') class='sk-toggleable__label sk-toggleable__label-arrow'>ad_spend_social_media</label><div class="sk-toggleable__content"><pre>ChainedEffects(steps=[(&#x27;adstock&#x27;, GeometricAdstockEffect()),
                      (&#x27;saturation&#x27;,
                       HillEffect(effect_mode=&#x27;additive&#x27;,
                                  half_max_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x31a3992d0 with batch shape () and event shape ()&gt;,
                                  input_scale=1000000.0,
                                  max_effect_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x315cee290 with batch shape () and event shape ()&gt;,
                                  slope_prior=&lt;numpyro.distributions.continuous.InverseGamma object at 0x31ab02090 with batch shape () and event shape ()&gt;))])</pre></div></div></div><div class="sk-serial"><div class='sk-item'><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('ab133b4c-623c-4d1a-83b5-1d1c790000ad') type="checkbox" ><label for=UUID('ab133b4c-623c-4d1a-83b5-1d1c790000ad') class='sk-toggleable__label sk-toggleable__label-arrow'>GeometricAdstockEffect</label><div class="sk-toggleable__content"><pre>GeometricAdstockEffect()</pre></div></div></div><div class='sk-item'><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('b6737d1e-1e6e-438d-9ace-567d13981b8c') type="checkbox" ><label for=UUID('b6737d1e-1e6e-438d-9ace-567d13981b8c') class='sk-toggleable__label sk-toggleable__label-arrow'>HillEffect</label><div class="sk-toggleable__content"><pre>HillEffect(effect_mode=&#x27;additive&#x27;,
           half_max_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x31a3992d0 with batch shape () and event shape ()&gt;,
           input_scale=1000000.0,
           max_effect_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x315cee290 with batch shape () and event shape ()&gt;,
           slope_prior=&lt;numpyro.distributions.continuous.InverseGamma object at 0x31ab02090 with batch shape () and event shape ()&gt;)</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class='sk-label-container'><div class="sk-label sk-toggleable"><label>inference_engine</label></div></div><div class="sk-serial"><div class='sk-item'><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('2cf76c95-5f90-404c-b40b-b741be13924e') type="checkbox" ><label for=UUID('2cf76c95-5f90-404c-b40b-b741be13924e') class='sk-toggleable__label sk-toggleable__label-arrow'>MAPInferenceEngine</label><div class="sk-toggleable__content"><pre>MAPInferenceEngine(num_steps=5000,
                   optimizer=LBFGSSolver(max_linesearch_steps=200,
                                         memory_size=200))</pre></div></div></div></div></div></div></div></div></div></div>

<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">y_pred</span> <span class="o">=</span> <span class="n">baseline_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">fh</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="c1"># Plot results</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="n">y</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Observed&quot;</span><span class="p">)</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="n">y_pred</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Predicted&quot;</span><span class="p">)</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;In-Sample Forecast: Observed vs Predicted&quot;</span><span class="p">)</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></div>
<p class="cell-output-title jp-RenderedText jp-OutputArea-output">Output: <span class="cell-output-count">[5]</span></p>

<p><img alt="png" src="index_files/output_7_0.png" /></p>
<h3 id="11-component-level-diagnostics">1.1 Component-Level Diagnostics</h3>
<p>Use <code>.predict_components()</code> to inspect <strong>decomposed effects</strong>:</p>
<ul>
<li>
<p>Trend and seasonality</p>
</li>
<li>
<p>Channel-specific effects</p>
</li>
</ul>
<p>üëâ <strong>Tip</strong>: This lets you debug which parts of your model are contributing (or not).</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">y_pred_components</span> <span class="o">=</span> <span class="n">baseline_model</span><span class="o">.</span><span class="n">predict_components</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">fh</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="n">y_pred_components</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></code></pre></div>
<p class="cell-output-title jp-RenderedText jp-OutputArea-output">Output: <span class="cell-output-count">[6]</span></p>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ad_spend_search</th>
      <th>ad_spend_social_media</th>
      <th>mean</th>
      <th>obs</th>
      <th>trend</th>
      <th>weekly_seasonality</th>
      <th>yearly_seasonality</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-01-01</th>
      <td>131520.111924</td>
      <td>1.150603e+06</td>
      <td>1.015148e+06</td>
      <td>1.053109e+06</td>
      <td>-286813.831445</td>
      <td>-12560.154761</td>
      <td>32398.696204</td>
    </tr>
    <tr>
      <th>2000-01-02</th>
      <td>143803.965722</td>
      <td>1.206190e+06</td>
      <td>1.102543e+06</td>
      <td>1.030596e+06</td>
      <td>-277749.525722</td>
      <td>-526.316360</td>
      <td>30825.164277</td>
    </tr>
    <tr>
      <th>2000-01-03</th>
      <td>148871.258969</td>
      <td>1.230351e+06</td>
      <td>1.136278e+06</td>
      <td>1.193281e+06</td>
      <td>-268685.219998</td>
      <td>-3484.000211</td>
      <td>29224.289349</td>
    </tr>
    <tr>
      <th>2000-01-04</th>
      <td>151241.204338</td>
      <td>1.245422e+06</td>
      <td>1.177322e+06</td>
      <td>1.126865e+06</td>
      <td>-259620.914275</td>
      <td>12676.912163</td>
      <td>27603.382378</td>
    </tr>
    <tr>
      <th>2000-01-05</th>
      <td>152278.861893</td>
      <td>1.252928e+06</td>
      <td>1.182174e+06</td>
      <td>1.172105e+06</td>
      <td>-250556.608552</td>
      <td>1554.128384</td>
      <td>25969.748353</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    <span class="p">[</span><span class="s2">&quot;trend&quot;</span><span class="p">,</span> <span class="s2">&quot;yearly_seasonality&quot;</span><span class="p">,</span> <span class="s2">&quot;ad_spend_search&quot;</span><span class="p">,</span> <span class="s2">&quot;ad_spend_social_media&quot;</span><span class="p">]</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="p">):</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>    <span class="n">true_components</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>    <span class="n">y_pred_components</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Estimated&quot;</span><span class="p">)</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></div>
<p class="cell-output-title jp-RenderedText jp-OutputArea-output">Output: <span class="cell-output-count">[7]</span></p>

<p><img alt="png" src="index_files/output_10_0.png" /></p>
<h3 id="12-backtesting-with-cross-validation">1.2 Backtesting with Cross-Validation</h3>
<p>We use rolling-window CV to assess out-of-sample accuracy using <strong>MAPE</strong>.</p>
<p>üß† <strong>Caution</strong>: Low error ‚â† correct attribution. But high error often indicates a bad model.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">sktime.split</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExpandingWindowSplitter</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">sktime.performance_metrics.forecasting</span><span class="w"> </span><span class="kn">import</span> <span class="n">MeanAbsolutePercentageError</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">sktime.forecasting.model_evaluation</span><span class="w"> </span><span class="kn">import</span> <span class="n">evaluate</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="n">metric</span> <span class="o">=</span> <span class="n">MeanAbsolutePercentageError</span><span class="p">()</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="n">cv</span> <span class="o">=</span> <span class="n">ExpandingWindowSplitter</span><span class="p">(</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>    <span class="n">initial_window</span><span class="o">=</span><span class="mi">365</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">step_length</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="n">fh</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">180</span><span class="p">))</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="p">)</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="n">cv_results</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>    <span class="n">forecaster</span><span class="o">=</span><span class="n">baseline_model</span><span class="p">,</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>    <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>    <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>    <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>    <span class="n">scoring</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>    <span class="n">return_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="p">)</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;test_MeanAbsolutePercentageError&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span></code></pre></div>
<p class="cell-output-title jp-RenderedText jp-OutputArea-output">Output: <span class="cell-output-count">[8]</span></p>

<div class="language-text highlight"><pre><span></span><code>np.float64(0.07168488379870389)
</code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cv_results</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>    <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;y_train&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;y_test&quot;</span><span class="p">]])</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Observed&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>    <span class="p">)</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>    <span class="n">row</span><span class="p">[</span><span class="s2">&quot;y_pred&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Prediction&quot;</span><span class="p">)</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fold </span><span class="si">{</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> ‚Äì MAPE: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;test_MeanAbsolutePercentageError&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>    <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>        <span class="k">break</span>
</span></code></pre></div>
<p class="cell-output-title jp-RenderedText jp-OutputArea-output">Output: <span class="cell-output-count">[9]</span></p>

<p><img alt="png" src="index_files/output_13_0.png" /></p>
<p><img alt="png" src="index_files/output_13_1.png" /></p>
<p><img alt="png" src="index_files/output_13_2.png" /></p>
<p><img alt="png" src="index_files/output_13_3.png" /></p>
<h3 id="13-saturation-curves">1.3 Saturation Curves</h3>
<p>These curves show <strong>diminishing marginal effect</strong> as spend increases.</p>
<p>üîç <strong>Insight</strong>: This shape helps guide budget allocation decisions (e.g. where additional spend will have little return).</p>
<p>Note how the model captures a saturation effect, but it is still far
from the correct shape.</p>
<p>This is why, in many situations, you will need calibration to
correct the model's behavior. This is what we will do in the next
section.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ad_spend_search&quot;</span><span class="p">,</span> <span class="s2">&quot;ad_spend_social_media&quot;</span><span class="p">]):</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">channel</span><span class="p">],</span> <span class="n">y_pred_components</span><span class="p">[</span><span class="n">channel</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">channel</span><span class="p">)</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">channel</span><span class="p">],</span> <span class="n">true_components</span><span class="p">[</span><span class="n">channel</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;True Effect&quot;</span><span class="p">)</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>        <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Daily Spend&quot;</span><span class="p">,</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>        <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Incremental Effect&quot;</span><span class="p">,</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>        <span class="n">title</span><span class="o">=</span><span class="n">channel</span> <span class="o">+</span> <span class="s2">&quot; - Saturation Curve&quot;</span><span class="p">,</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>    <span class="p">)</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></div>
<p class="cell-output-title jp-RenderedText jp-OutputArea-output">Output: <span class="cell-output-count">[10]</span></p>

<p><img alt="png" src="index_files/output_15_0.png" /></p>
<hr />
<h2 id="part-2-calibration-with-causal-evidence">Part 2: Calibration with Causal Evidence</h2>
<p>Time-series alone <strong>cannot disentangle</strong> correlated channels.
We integrate <strong>lift tests</strong> (local experiments) and <strong>attribution models</strong> (high-resolution signal) to correct this.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">lift_test1</span>
</span></code></pre></div>
<p class="cell-output-title jp-RenderedText jp-OutputArea-output">Output: <span class="cell-output-count">[11]</span></p>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lift</th>
      <th>x_start</th>
      <th>x_end</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2004-10-06</th>
      <td>1.052582</td>
      <td>40341.767154</td>
      <td>49484.088269</td>
    </tr>
    <tr>
      <th>2004-02-04</th>
      <td>1.032892</td>
      <td>58495.653884</td>
      <td>84002.024994</td>
    </tr>
    <tr>
      <th>2000-11-06</th>
      <td>1.016679</td>
      <td>71531.092985</td>
      <td>76531.908954</td>
    </tr>
    <tr>
      <th>2003-05-16</th>
      <td>1.124607</td>
      <td>26907.284427</td>
      <td>32512.144296</td>
    </tr>
    <tr>
      <th>2000-11-08</th>
      <td>1.020869</td>
      <td>72599.750597</td>
      <td>89604.382819</td>
    </tr>
    <tr>
      <th>2004-03-07</th>
      <td>1.031745</td>
      <td>52757.679186</td>
      <td>64868.518216</td>
    </tr>
    <tr>
      <th>2000-05-07</th>
      <td>1.012662</td>
      <td>99996.136061</td>
      <td>94223.267215</td>
    </tr>
    <tr>
      <th>2001-02-19</th>
      <td>1.010134</td>
      <td>65093.431461</td>
      <td>61643.297561</td>
    </tr>
    <tr>
      <th>2002-04-02</th>
      <td>1.025119</td>
      <td>61348.678757</td>
      <td>75097.513522</td>
    </tr>
    <tr>
      <th>2002-12-05</th>
      <td>0.941962</td>
      <td>15130.845106</td>
      <td>14559.409409</td>
    </tr>
    <tr>
      <th>2002-07-17</th>
      <td>1.033300</td>
      <td>50602.621004</td>
      <td>61561.222390</td>
    </tr>
    <tr>
      <th>2004-04-27</th>
      <td>1.028811</td>
      <td>63706.416166</td>
      <td>92286.506107</td>
    </tr>
    <tr>
      <th>2000-07-17</th>
      <td>1.010703</td>
      <td>92339.710079</td>
      <td>82120.888097</td>
    </tr>
    <tr>
      <th>2002-12-12</th>
      <td>1.736021</td>
      <td>10447.017057</td>
      <td>13154.365751</td>
    </tr>
    <tr>
      <th>2000-04-21</th>
      <td>1.009817</td>
      <td>96608.570357</td>
      <td>82236.408066</td>
    </tr>
    <tr>
      <th>2004-08-14</th>
      <td>1.010487</td>
      <td>56934.883132</td>
      <td>55014.981073</td>
    </tr>
    <tr>
      <th>2003-05-27</th>
      <td>1.253717</td>
      <td>20725.849866</td>
      <td>25917.050369</td>
    </tr>
    <tr>
      <th>2003-07-14</th>
      <td>1.212511</td>
      <td>25704.179569</td>
      <td>36440.566373</td>
    </tr>
    <tr>
      <th>2001-02-01</th>
      <td>1.019457</td>
      <td>67352.193243</td>
      <td>75884.561853</td>
    </tr>
    <tr>
      <th>2003-11-23</th>
      <td>1.031476</td>
      <td>55990.598602</td>
      <td>72568.532869</td>
    </tr>
    <tr>
      <th>2001-10-26</th>
      <td>1.025174</td>
      <td>67906.685182</td>
      <td>93399.577025</td>
    </tr>
    <tr>
      <th>2004-01-06</th>
      <td>1.019301</td>
      <td>60549.085047</td>
      <td>65612.128260</td>
    </tr>
    <tr>
      <th>2004-07-17</th>
      <td>1.025315</td>
      <td>67354.435955</td>
      <td>92061.937569</td>
    </tr>
    <tr>
      <th>2002-10-21</th>
      <td>1.356352</td>
      <td>19342.497501</td>
      <td>25654.928003</td>
    </tr>
    <tr>
      <th>2001-09-17</th>
      <td>1.007672</td>
      <td>66940.425562</td>
      <td>60975.537748</td>
    </tr>
    <tr>
      <th>2004-11-30</th>
      <td>1.130302</td>
      <td>27602.264625</td>
      <td>34344.815009</td>
    </tr>
    <tr>
      <th>2004-12-26</th>
      <td>1.022175</td>
      <td>38511.161989</td>
      <td>39737.886356</td>
    </tr>
    <tr>
      <th>2001-09-20</th>
      <td>1.023819</td>
      <td>64080.310879</td>
      <td>78594.396432</td>
    </tr>
    <tr>
      <th>2002-05-16</th>
      <td>1.015904</td>
      <td>65554.939615</td>
      <td>67996.877272</td>
    </tr>
    <tr>
      <th>2003-10-31</th>
      <td>1.014672</td>
      <td>53044.156616</td>
      <td>53463.620520</td>
    </tr>
  </tbody>
</table>
</div>

<h3 id="21-visualizing-lift-tests">2.1 Visualizing Lift Tests</h3>
<p>Each experiment records: pre-spend (<code>x_start</code>), post-spend (<code>x_end</code>), and measured <code>lift</code>.
These give us <strong>causal ‚Äúground truth‚Äù deltas</strong>.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lift_test1</span><span class="p">[</span><span class="s2">&quot;x_start&quot;</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">lift_test1</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Pre-Spend&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lift_test1</span><span class="p">[</span><span class="s2">&quot;x_end&quot;</span><span class="p">],</span> <span class="n">lift_test1</span><span class="p">[</span><span class="s2">&quot;lift&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Observed Lift&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">lift_test1</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>        <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;x_end&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;lift&quot;</span><span class="p">]),</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>        <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;x_start&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>        <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-&gt;&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>    <span class="p">)</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Search Ads Lift Tests&quot;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Spend&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Revenue Ratio&quot;</span><span class="p">)</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></div>
<p class="cell-output-title jp-RenderedText jp-OutputArea-output">Output: <span class="cell-output-count">[12]</span></p>

<p><img alt="png" src="index_files/output_19_0.png" /></p>
<h3 id="22-improve-estimates-via-liftexperimentlikelihood">2.2 Improve Estimates via LiftExperimentLikelihood</h3>
<p>This adds a new <strong>likelihood term</strong> that makes the model match lift observations.</p>
<p>üîÅ <strong>Still Bayesian</strong>: It incorporates test variance and model uncertainty.</p>
<p>Since we use <code>sktime</code> interface, we have access to <code>get_params()</code> and <code>set_params(**kwargs)</code> methods.
This allows us to <strong>easily swap</strong> effects and likelihoods.
When we define our model, the effect's name become a key in the model's
<code>get_params()</code> dictionary. We can use this to set the effect's parameters
directly.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">prophetverse.effects.lift_likelihood</span><span class="w"> </span><span class="kn">import</span> <span class="n">LiftExperimentLikelihood</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="n">model_lift</span> <span class="o">=</span> <span class="n">baseline_model</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="n">model_lift</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>    <span class="n">ad_spend_search</span><span class="o">=</span><span class="n">LiftExperimentLikelihood</span><span class="p">(</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>        <span class="n">effect</span><span class="o">=</span><span class="n">baseline_model</span><span class="o">.</span><span class="n">get_params</span><span class="p">()[</span><span class="s2">&quot;ad_spend_search&quot;</span><span class="p">],</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>        <span class="n">lift_test_results</span><span class="o">=</span><span class="n">lift_test1</span><span class="p">,</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>        <span class="n">prior_scale</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>    <span class="p">),</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>    <span class="n">ad_spend_social_media</span><span class="o">=</span><span class="n">LiftExperimentLikelihood</span><span class="p">(</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>        <span class="n">effect</span><span class="o">=</span><span class="n">baseline_model</span><span class="o">.</span><span class="n">get_params</span><span class="p">()[</span><span class="s2">&quot;ad_spend_social_media&quot;</span><span class="p">],</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>        <span class="n">lift_test_results</span><span class="o">=</span><span class="n">lift_test2</span><span class="p">,</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>        <span class="n">prior_scale</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>    <span class="p">),</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="p">)</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="n">model_lift</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">)</span>
</span></code></pre></div>
<p class="cell-output-title jp-RenderedText jp-OutputArea-output">Output: <span class="cell-output-count">[13]</span></p>

<style>#sk-164be762-2a09-48b1-950f-abec7d4dd5cb {
    /* Definition of color scheme common for light and dark mode */
    --sklearn-color-text: black;
    --sklearn-color-line: gray;
    /* Definition of color scheme for objects */
    --sklearn-color-level-0: #fff5e6;
    --sklearn-color-level-1: #f6e4d2;
    --sklearn-color-level-2: #ffe0b3;
    --sklearn-color-level-3: chocolate;

    /* Specific color for light theme */
    --sklearn-color-text-on-default-background: var(--theme-code-foreground, var(--jp-content-font-color1, black));
    --sklearn-color-background: var(--theme-background, var(--jp-layout-color0, white));
    --sklearn-color-border-box: var(--theme-code-foreground, var(--jp-content-font-color1, black));
    --sklearn-color-icon: #696969;

    @media (prefers-color-scheme: dark) {
      /* Redefinition of color scheme for dark theme */
      --sklearn-color-text-on-default-background: var(--theme-code-foreground, var(--jp-content-font-color1, white));
      --sklearn-color-background: var(--theme-background, var(--jp-layout-color0, #111));
      --sklearn-color-border-box: var(--theme-code-foreground, var(--jp-content-font-color1, white));
      --sklearn-color-icon: #878787;
    }
  }

  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb {
    color: var(--sklearn-color-text);
  }

  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb pre {
    padding: 0;
  }

  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb input.sk-hidden--visually {
    border: 0;
    clip: rect(1px 1px 1px 1px);
    clip: rect(1px, 1px, 1px, 1px);
    height: 1px;
    margin: -1px;
    overflow: hidden;
    padding: 0;
    position: absolute;
    width: 1px;
  }

  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb div.sk-dashed-wrapped {
    border: 1px dashed var(--sklearn-color-line);
    margin: 0 0.4em 0.5em 0.4em;
    box-sizing: border-box;
    padding-bottom: 0.4em;
    background-color: var(--sklearn-color-background);
  }

  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb div.sk-container {
    /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
       but bootstrap.min.css set `[hidden] { display: none !important; }`
       so we also need the `!important` here to be able to override the
       default hidden behavior on the sphinx rendered scikit-learn.org.
       See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
    display: inline-block !important;
    position: relative;
  }

  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb div.sk-text-repr-fallback {
    display: none;
  }

  div.sk-parallel-item,
  div.sk-serial,
  div.sk-item {
    /* draw centered vertical line to link estimators */
    background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
    background-size: 2px 100%;
    background-repeat: no-repeat;
    background-position: center center;
  }

  /* Parallel-specific style estimator block */

  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb div.sk-parallel-item::after {
    content: "";
    width: 100%;
    border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
    flex-grow: 1;
  }

  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb div.sk-parallel {
    display: flex;
    align-items: stretch;
    justify-content: center;
    background-color: var(--sklearn-color-background);
    position: relative;
  }

  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb div.sk-parallel-item {
    display: flex;
    flex-direction: column;
  }

  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb div.sk-parallel-item:first-child::after {
    align-self: flex-end;
    width: 50%;
  }

  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb div.sk-parallel-item:last-child::after {
    align-self: flex-start;
    width: 50%;
  }

  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb div.sk-parallel-item:only-child::after {
    width: 0;
  }

  /* Serial-specific style estimator block */

  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb div.sk-serial {
    display: flex;
    flex-direction: column;
    align-items: center;
    background-color: var(--sklearn-color-background);
    padding-right: 1em;
    padding-left: 1em;
  }


  /* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
  clickable and can be expanded/collapsed.
  - Pipeline and ColumnTransformer use this feature and define the default style
  - Estimators will overwrite some part of the style using the `sk-estimator` class
  */

  /* Pipeline and ColumnTransformer style (default) */

  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb div.sk-toggleable {
    /* Default theme specific background. It is overwritten whether we have a
    specific estimator or a Pipeline/ColumnTransformer */
    background-color: var(--sklearn-color-background);
  }

  /* Toggleable label */
  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb label.sk-toggleable__label {
    cursor: pointer;
    display: block;
    width: 100%;
    margin-bottom: 0;
    padding: 0.5em;
    box-sizing: border-box;
    text-align: center;
  }

  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb label.sk-toggleable__label-arrow:before {
    /* Arrow on the left of the label */
    content: "‚ñ∏";
    float: left;
    margin-right: 0.25em;
    color: var(--sklearn-color-icon);
  }

  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb label.sk-toggleable__label-arrow:hover:before {
    color: var(--sklearn-color-text);
  }

  /* Toggleable content - dropdown */

  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb div.sk-toggleable__content {
    max-height: 0;
    max-width: 0;
    overflow: hidden;
    text-align: left;
    background-color: var(--sklearn-color-level-0);
  }

  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb div.sk-toggleable__content pre {
    margin: 0.2em;
    border-radius: 0.25em;
    color: var(--sklearn-color-text);
    background-color: var(--sklearn-color-level-0);
  }

  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb input.sk-toggleable__control:checked~div.sk-toggleable__content {
    /* Expand drop-down */
    max-height: 200px;
    max-width: 100%;
    overflow: auto;
  }

  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
    content: "‚ñæ";
  }

  /* Pipeline/ColumnTransformer-specific style */

  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
    color: var(--sklearn-color-text);
    background-color: var(--sklearn-color-level-2);
  }

  /* Estimator-specific style */

  /* Colorize estimator box */
  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
    /* unfitted */
    background-color: var(--sklearn-color-level-2);
  }

  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb div.sk-label label.sk-toggleable__label,
  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb div.sk-label label {
    /* The background is the default theme color */
    color: var(--sklearn-color-text-on-default-background);
  }

  /* On hover, darken the color of the background */
  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb div.sk-label:hover label.sk-toggleable__label {
    color: var(--sklearn-color-text);
    background-color: var(--sklearn-color-level-2);
  }

  /* Estimator label */

  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb div.sk-label label {
    font-family: monospace;
    font-weight: bold;
    display: inline-block;
    line-height: 1.2em;
  }

  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb div.sk-label-container {
    text-align: center;
  }

  /* Estimator-specific */
  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb div.sk-estimator {
    font-family: monospace;
    border: 1px dotted var(--sklearn-color-border-box);
    border-radius: 0.25em;
    box-sizing: border-box;
    margin-bottom: 0.5em;
    background-color: var(--sklearn-color-level-0);
  }

  /* on hover */
  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb div.sk-estimator:hover {
    background-color: var(--sklearn-color-level-2);
  }

  /* Specification for estimator info */

  .sk-estimator-doc-link,
  a:link.sk-estimator-doc-link,
  a:visited.sk-estimator-doc-link {
    float: right;
    font-size: smaller;
    line-height: 1em;
    font-family: monospace;
    background-color: var(--sklearn-color-background);
    border-radius: 1em;
    height: 1em;
    width: 1em;
    text-decoration: none !important;
    margin-left: 1ex;
    border: var(--sklearn-color-level-1) 1pt solid;
    color: var(--sklearn-color-level-1);
  }

  /* On hover */
  div.sk-estimator:hover .sk-estimator-doc-link:hover,
  .sk-estimator-doc-link:hover,
  div.sk-label-container:hover .sk-estimator-doc-link:hover,
  .sk-estimator-doc-link:hover {
    background-color: var(--sklearn-color-level-3);
    color: var(--sklearn-color-background);
    text-decoration: none;
  }

  /* Span, style for the box shown on hovering the info icon */
  .sk-estimator-doc-link span {
    display: none;
    z-index: 9999;
    position: relative;
    font-weight: normal;
    right: .2ex;
    padding: .5ex;
    margin: .5ex;
    width: min-content;
    min-width: 20ex;
    max-width: 50ex;
    color: var(--sklearn-color-text);
    box-shadow: 2pt 2pt 4pt #999;
    background: var(--sklearn-color-level-0);
    border: .5pt solid var(--sklearn-color-level-3);
  }

  .sk-estimator-doc-link:hover span {
    display: block;
  }

  /* "?"-specific style due to the `<a>` HTML tag */

  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb a.estimator_doc_link {
    float: right;
    font-size: 1rem;
    line-height: 1em;
    font-family: monospace;
    background-color: var(--sklearn-color-background);
    border-radius: 1rem;
    height: 1rem;
    width: 1rem;
    text-decoration: none;
    color: var(--sklearn-color-level-1);
    border: var(--sklearn-color-level-1) 1pt solid;
  }

  /* On hover */
  #sk-164be762-2a09-48b1-950f-abec7d4dd5cb a.estimator_doc_link:hover {
    background-color: var(--sklearn-color-level-3);
    color: var(--sklearn-color-background);
    text-decoration: none;
  }
</style>
<div id='sk-164be762-2a09-48b1-950f-abec7d4dd5cb' class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Prophetverse(exogenous_effects=[(&#x27;yearly_seasonality&#x27;,
                                 LinearFourierSeasonality(effect_mode=&#x27;multiplicative&#x27;,
                                                          fourier_terms_list=[5],
                                                          freq=&#x27;D&#x27;,
                                                          prior_scale=0.1,
                                                          sp_list=[365.25]),
                                 None),
                                (&#x27;weekly_seasonality&#x27;,
                                 LinearFourierSeasonality(effect_mode=&#x27;multiplicative&#x27;,
                                                          fourier_terms_list=[3],
                                                          freq=&#x27;D&#x27;,
                                                          prior_scale=0.05,
                                                          sp_list=[7]),
                                 None),
                                (&#x27;ad_spend_search&#x27;,
                                 LiftExp...
2002-01-29  0.989574   39214.672134   56545.763983
2001-05-19  0.985555   46499.449093   40163.797819
2002-11-15  1.200436    1451.982807    1752.828046
2001-08-11  0.984737   64502.380804   62625.006901,
                                                          prior_scale=0.01),
                                 &#x27;ad_spend_social_media&#x27;)],
             inference_engine=MAPInferenceEngine(num_steps=5000,
                                                 optimizer=LBFGSSolver(max_linesearch_steps=200,
                                                                       memory_size=200)),
             trend=PiecewiseLinearTrend(changepoint_interval=100))</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class='sk-label-container'><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('914817a1-f55d-4e4c-ac71-6406a41b75bb') type="checkbox" ><label for=UUID('914817a1-f55d-4e4c-ac71-6406a41b75bb') class='sk-toggleable__label sk-toggleable__label-arrow'>Prophetverse</label><div class="sk-toggleable__content"><pre>Prophetverse(exogenous_effects=[(&#x27;yearly_seasonality&#x27;,
                                 LinearFourierSeasonality(effect_mode=&#x27;multiplicative&#x27;,
                                                          fourier_terms_list=[5],
                                                          freq=&#x27;D&#x27;,
                                                          prior_scale=0.1,
                                                          sp_list=[365.25]),
                                 None),
                                (&#x27;weekly_seasonality&#x27;,
                                 LinearFourierSeasonality(effect_mode=&#x27;multiplicative&#x27;,
                                                          fourier_terms_list=[3],
                                                          freq=&#x27;D&#x27;,
                                                          prior_scale=0.05,
                                                          sp_list=[7]),
                                 None),
                                (&#x27;ad_spend_search&#x27;,
                                 LiftExp...
2002-01-29  0.989574   39214.672134   56545.763983
2001-05-19  0.985555   46499.449093   40163.797819
2002-11-15  1.200436    1451.982807    1752.828046
2001-08-11  0.984737   64502.380804   62625.006901,
                                                          prior_scale=0.01),
                                 &#x27;ad_spend_social_media&#x27;)],
             inference_engine=MAPInferenceEngine(num_steps=5000,
                                                 optimizer=LBFGSSolver(max_linesearch_steps=200,
                                                                       memory_size=200)),
             trend=PiecewiseLinearTrend(changepoint_interval=100))</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class='sk-label-container'><div class="sk-label sk-toggleable"><label>effects</label></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class='sk-item'><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('b4c88c72-3814-4f1e-8da1-26e313c21a44') type="checkbox" ><label for=UUID('b4c88c72-3814-4f1e-8da1-26e313c21a44') class='sk-toggleable__label sk-toggleable__label-arrow'>PiecewiseLinearTrend</label><div class="sk-toggleable__content"><pre>PiecewiseLinearTrend(changepoint_interval=100)</pre></div></div></div><div class='sk-item'><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('2c01efef-8eaf-475c-a81e-e123951b1786') type="checkbox" ><label for=UUID('2c01efef-8eaf-475c-a81e-e123951b1786') class='sk-toggleable__label sk-toggleable__label-arrow'>LinearFourierSeasonality</label><div class="sk-toggleable__content"><pre>LinearFourierSeasonality(effect_mode=&#x27;multiplicative&#x27;, fourier_terms_list=[5],
                         freq=&#x27;D&#x27;, prior_scale=0.1, sp_list=[365.25])</pre></div></div></div><div class='sk-item'><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('3e7a2339-d8e3-4a98-a16c-cdeb67838531') type="checkbox" ><label for=UUID('3e7a2339-d8e3-4a98-a16c-cdeb67838531') class='sk-toggleable__label sk-toggleable__label-arrow'>LinearFourierSeasonality</label><div class="sk-toggleable__content"><pre>LinearFourierSeasonality(effect_mode=&#x27;multiplicative&#x27;, fourier_terms_list=[3],
                         freq=&#x27;D&#x27;, prior_scale=0.05, sp_list=[7])</pre></div></div></div><div class="sk-item sk-dashed-wrapped"><div class='sk-label-container'><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('370a598a-086a-4d88-a1cd-7a1eee42851e') type="checkbox" ><label for=UUID('370a598a-086a-4d88-a1cd-7a1eee42851e') class='sk-toggleable__label sk-toggleable__label-arrow'>ad_spend_search</label><div class="sk-toggleable__content"><pre>LiftExperimentLikelihood(effect=ChainedEffects(steps=[(&#x27;adstock&#x27;,
                                                       GeometricAdstockEffect()),
                                                      (&#x27;saturation&#x27;,
                                                       HillEffect(effect_mode=&#x27;additive&#x27;,
                                                                  half_max_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x31a3992d0 with batch shape () and event shape ()&gt;,
                                                                  input_scale=1000000.0,
                                                                  max_effect_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x315cee2...
2004-07-17  1.025315  67354.435955  92061.937569
2002-10-21  1.356352  19342.497501  25654.928003
2001-09-17  1.007672  66940.425562  60975.537748
2004-11-30  1.130302  27602.264625  34344.815009
2004-12-26  1.022175  38511.161989  39737.886356
2001-09-20  1.023819  64080.310879  78594.396432
2002-05-16  1.015904  65554.939615  67996.877272
2003-10-31  1.014672  53044.156616  53463.620520,
                         prior_scale=0.01)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class='sk-label-container'><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('8d7a5e7c-088e-4eb8-b30e-b0deb74af7a5') type="checkbox" ><label for=UUID('8d7a5e7c-088e-4eb8-b30e-b0deb74af7a5') class='sk-toggleable__label sk-toggleable__label-arrow'>effect: ChainedEffects</label><div class="sk-toggleable__content"><pre>ChainedEffects(steps=[(&#x27;adstock&#x27;, GeometricAdstockEffect()),
                      (&#x27;saturation&#x27;,
                       HillEffect(effect_mode=&#x27;additive&#x27;,
                                  half_max_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x31a3992d0 with batch shape () and event shape ()&gt;,
                                  input_scale=1000000.0,
                                  max_effect_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x315cee290 with batch shape () and event shape ()&gt;,
                                  slope_prior=&lt;numpyro.distributions.continuous.InverseGamma object at 0x31ab02090 with batch shape () and event shape ()&gt;))])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class='sk-item'><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('37bb5564-3aee-474a-86c2-6f28667f4a10') type="checkbox" ><label for=UUID('37bb5564-3aee-474a-86c2-6f28667f4a10') class='sk-toggleable__label sk-toggleable__label-arrow'>GeometricAdstockEffect</label><div class="sk-toggleable__content"><pre>GeometricAdstockEffect()</pre></div></div></div><div class='sk-item'><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('62dd01b6-ac3b-4df3-91fb-cdeac898fb8a') type="checkbox" ><label for=UUID('62dd01b6-ac3b-4df3-91fb-cdeac898fb8a') class='sk-toggleable__label sk-toggleable__label-arrow'>HillEffect</label><div class="sk-toggleable__content"><pre>HillEffect(effect_mode=&#x27;additive&#x27;,
           half_max_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x31a3992d0 with batch shape () and event shape ()&gt;,
           input_scale=1000000.0,
           max_effect_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x315cee290 with batch shape () and event shape ()&gt;,
           slope_prior=&lt;numpyro.distributions.continuous.InverseGamma object at 0x31ab02090 with batch shape () and event shape ()&gt;)</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item sk-dashed-wrapped"><div class='sk-label-container'><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('d93d6603-206f-425a-945e-dfcc75a1fb73') type="checkbox" ><label for=UUID('d93d6603-206f-425a-945e-dfcc75a1fb73') class='sk-toggleable__label sk-toggleable__label-arrow'>ad_spend_social_media</label><div class="sk-toggleable__content"><pre>LiftExperimentLikelihood(effect=ChainedEffects(steps=[(&#x27;adstock&#x27;,
                                                       GeometricAdstockEffect()),
                                                      (&#x27;saturation&#x27;,
                                                       HillEffect(effect_mode=&#x27;additive&#x27;,
                                                                  half_max_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x31a3992d0 with batch shape () and event shape ()&gt;,
                                                                  input_scale=1000000.0,
                                                                  max_effect_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x315cee2...
2004-03-12  0.993162   23495.675246   24478.491907
2001-10-29  0.984360   44379.074948   37313.349224
2002-05-30  0.989024   27726.620636   31907.853065
2003-01-02  1.010906    1773.725603    1554.825745
2002-01-29  0.989574   39214.672134   56545.763983
2001-05-19  0.985555   46499.449093   40163.797819
2002-11-15  1.200436    1451.982807    1752.828046
2001-08-11  0.984737   64502.380804   62625.006901,
                         prior_scale=0.01)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class='sk-label-container'><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('35c495f8-37b4-4f8e-974a-1a8ebaf7e17b') type="checkbox" ><label for=UUID('35c495f8-37b4-4f8e-974a-1a8ebaf7e17b') class='sk-toggleable__label sk-toggleable__label-arrow'>effect: ChainedEffects</label><div class="sk-toggleable__content"><pre>ChainedEffects(steps=[(&#x27;adstock&#x27;, GeometricAdstockEffect()),
                      (&#x27;saturation&#x27;,
                       HillEffect(effect_mode=&#x27;additive&#x27;,
                                  half_max_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x31a3992d0 with batch shape () and event shape ()&gt;,
                                  input_scale=1000000.0,
                                  max_effect_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x315cee290 with batch shape () and event shape ()&gt;,
                                  slope_prior=&lt;numpyro.distributions.continuous.InverseGamma object at 0x31ab02090 with batch shape () and event shape ()&gt;))])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class='sk-item'><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('798cfafa-0d94-48fd-8b14-115675fc1e6e') type="checkbox" ><label for=UUID('798cfafa-0d94-48fd-8b14-115675fc1e6e') class='sk-toggleable__label sk-toggleable__label-arrow'>GeometricAdstockEffect</label><div class="sk-toggleable__content"><pre>GeometricAdstockEffect()</pre></div></div></div><div class='sk-item'><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('91cb6df6-b1d4-4f87-9900-112d28b5e567') type="checkbox" ><label for=UUID('91cb6df6-b1d4-4f87-9900-112d28b5e567') class='sk-toggleable__label sk-toggleable__label-arrow'>HillEffect</label><div class="sk-toggleable__content"><pre>HillEffect(effect_mode=&#x27;additive&#x27;,
           half_max_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x31a3992d0 with batch shape () and event shape ()&gt;,
           input_scale=1000000.0,
           max_effect_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x315cee290 with batch shape () and event shape ()&gt;,
           slope_prior=&lt;numpyro.distributions.continuous.InverseGamma object at 0x31ab02090 with batch shape () and event shape ()&gt;)</pre></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class='sk-label-container'><div class="sk-label sk-toggleable"><label>inference_engine</label></div></div><div class="sk-serial"><div class='sk-item'><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('16a083c5-a994-4591-9a9d-84493e9573d2') type="checkbox" ><label for=UUID('16a083c5-a994-4591-9a9d-84493e9573d2') class='sk-toggleable__label sk-toggleable__label-arrow'>MAPInferenceEngine</label><div class="sk-toggleable__content"><pre>MAPInferenceEngine(num_steps=5000,
                   optimizer=LBFGSSolver(max_linesearch_steps=200,
                                         memory_size=200))</pre></div></div></div></div></div></div></div></div></div></div>

<div class="language-python highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">components_lift</span> <span class="o">=</span> <span class="n">model_lift</span><span class="o">.</span><span class="n">predict_components</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">fh</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="n">components_lift</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></code></pre></div>
<p class="cell-output-title jp-RenderedText jp-OutputArea-output">Output: <span class="cell-output-count">[14]</span></p>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ad_spend_search</th>
      <th>ad_spend_social_media</th>
      <th>mean</th>
      <th>obs</th>
      <th>trend</th>
      <th>weekly_seasonality</th>
      <th>yearly_seasonality</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-01-01</th>
      <td>1.162689e+06</td>
      <td>35705.242566</td>
      <td>1.101109e+06</td>
      <td>1.139029e+06</td>
      <td>-104452.881522</td>
      <td>-4534.357116</td>
      <td>11702.518169</td>
    </tr>
    <tr>
      <th>2000-01-02</th>
      <td>1.163530e+06</td>
      <td>35786.143107</td>
      <td>1.115020e+06</td>
      <td>1.043151e+06</td>
      <td>-94557.682380</td>
      <td>-164.487497</td>
      <td>10426.187964</td>
    </tr>
    <tr>
      <th>2000-01-03</th>
      <td>1.163845e+06</td>
      <td>35803.215672</td>
      <td>1.123059e+06</td>
      <td>1.180000e+06</td>
      <td>-84662.483239</td>
      <td>-1092.249544</td>
      <td>9165.351790</td>
    </tr>
    <tr>
      <th>2000-01-04</th>
      <td>1.163901e+06</td>
      <td>35812.314845</td>
      <td>1.136486e+06</td>
      <td>1.086083e+06</td>
      <td>-74767.284097</td>
      <td>3612.584111</td>
      <td>7927.087023</td>
    </tr>
    <tr>
      <th>2000-01-05</th>
      <td>1.163661e+06</td>
      <td>35810.765437</td>
      <td>1.141719e+06</td>
      <td>1.131661e+06</td>
      <td>-64872.084955</td>
      <td>401.225818</td>
      <td>6718.395100</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1"># Compare predicted effects with updated styling</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ad_spend_search&quot;</span><span class="p">,</span> <span class="s2">&quot;ad_spend_social_media&quot;</span><span class="p">]):</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>        <span class="n">X</span><span class="p">[</span><span class="n">channel</span><span class="p">],</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>        <span class="n">y_pred_components</span><span class="p">[</span><span class="n">channel</span><span class="p">],</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Baseline&quot;</span><span class="p">,</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>        <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>    <span class="p">)</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>        <span class="n">X</span><span class="p">[</span><span class="n">channel</span><span class="p">],</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>        <span class="n">components_lift</span><span class="p">[</span><span class="n">channel</span><span class="p">],</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;With Lift Test&quot;</span><span class="p">,</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>        <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>    <span class="p">)</span>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>        <span class="n">X</span><span class="p">[</span><span class="n">channel</span><span class="p">],</span>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>        <span class="n">true_components</span><span class="p">[</span><span class="n">channel</span><span class="p">],</span>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span>
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="__span-14-25"><a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a>    <span class="p">)</span>
</span><span id="__span-14-26"><a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
</span><span id="__span-14-27"><a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a>        <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">channel</span><span class="si">}</span><span class="s2"> Predicted Effects&quot;</span><span class="p">,</span>
</span><span id="__span-14-28"><a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a>        <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Daily Spend&quot;</span><span class="p">,</span>
</span><span id="__span-14-29"><a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a>        <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Incremental Effect&quot;</span><span class="p">,</span>
</span><span id="__span-14-30"><a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a>    <span class="p">)</span>
</span><span id="__span-14-31"><a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
</span><span id="__span-14-32"><a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="__span-14-33"><a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="__span-14-34"><a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></div>
<p class="cell-output-title jp-RenderedText jp-OutputArea-output">Output: <span class="cell-output-count">[15]</span></p>

<p><img alt="png" src="index_files/output_23_0.png" /></p>
<p>Much better, right? And it was implemented with a really modular and flexible code.
You could wrap any effect with <code>LiftExperimentLikelihood</code> to add lift test data to
guide its behaviour.</p>
<h3 id="23-add-attribution-signals-with-exactlikelihood">2.3 Add Attribution Signals with ExactLikelihood</h3>
<p>Attribution models can provide <strong>daily signals</strong>. If available, you can
incorporate them by adding another likelihood term via <code>ExactLikelihood</code>.</p>
<p>We create a synthetic attribution signal by multiplying the true effect with a
random noise factor.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">prophetverse.effects</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExactLikelihood</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="n">attr_search</span> <span class="o">=</span> <span class="n">true_components</span><span class="p">[[</span><span class="s2">&quot;ad_spend_search&quot;</span><span class="p">]]</span> <span class="o">*</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>    <span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="p">)</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="n">attr_social</span> <span class="o">=</span> <span class="n">true_components</span><span class="p">[[</span><span class="s2">&quot;ad_spend_social_media&quot;</span><span class="p">]]</span> <span class="o">*</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>    <span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="p">)</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="n">attr_social</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></code></pre></div>
<p class="cell-output-title jp-RenderedText jp-OutputArea-output">Output: <span class="cell-output-count">[16]</span></p>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ad_spend_social_media</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-01-01</th>
      <td>88305.141575</td>
    </tr>
    <tr>
      <th>2000-01-02</th>
      <td>96298.364313</td>
    </tr>
    <tr>
      <th>2000-01-03</th>
      <td>106375.410968</td>
    </tr>
    <tr>
      <th>2000-01-04</th>
      <td>99764.344046</td>
    </tr>
    <tr>
      <th>2000-01-05</th>
      <td>88181.843186</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">model_umm</span> <span class="o">=</span> <span class="n">model_lift</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="n">model_umm</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>    <span class="n">exogenous_effects</span><span class="o">=</span><span class="n">model_lift</span><span class="o">.</span><span class="n">get_params</span><span class="p">()[</span><span class="s2">&quot;exogenous_effects&quot;</span><span class="p">]</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>    <span class="o">+</span> <span class="p">[</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>        <span class="p">(</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>            <span class="s2">&quot;attribution_search&quot;</span><span class="p">,</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>            <span class="n">ExactLikelihood</span><span class="p">(</span><span class="s2">&quot;ad_spend_search&quot;</span><span class="p">,</span> <span class="n">attr_search</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">),</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>            <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>        <span class="p">),</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>        <span class="p">(</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>            <span class="s2">&quot;attribution_social_media&quot;</span><span class="p">,</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>            <span class="n">ExactLikelihood</span><span class="p">(</span><span class="s2">&quot;ad_spend_social_media&quot;</span><span class="p">,</span> <span class="n">attr_social</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">),</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>            <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>        <span class="p">),</span>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>    <span class="p">]</span>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="p">)</span>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="n">model_umm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">)</span>
</span></code></pre></div>
<p class="cell-output-title jp-RenderedText jp-OutputArea-output">Output: <span class="cell-output-count">[17]</span></p>

<style>#sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d {
    /* Definition of color scheme common for light and dark mode */
    --sklearn-color-text: black;
    --sklearn-color-line: gray;
    /* Definition of color scheme for objects */
    --sklearn-color-level-0: #fff5e6;
    --sklearn-color-level-1: #f6e4d2;
    --sklearn-color-level-2: #ffe0b3;
    --sklearn-color-level-3: chocolate;

    /* Specific color for light theme */
    --sklearn-color-text-on-default-background: var(--theme-code-foreground, var(--jp-content-font-color1, black));
    --sklearn-color-background: var(--theme-background, var(--jp-layout-color0, white));
    --sklearn-color-border-box: var(--theme-code-foreground, var(--jp-content-font-color1, black));
    --sklearn-color-icon: #696969;

    @media (prefers-color-scheme: dark) {
      /* Redefinition of color scheme for dark theme */
      --sklearn-color-text-on-default-background: var(--theme-code-foreground, var(--jp-content-font-color1, white));
      --sklearn-color-background: var(--theme-background, var(--jp-layout-color0, #111));
      --sklearn-color-border-box: var(--theme-code-foreground, var(--jp-content-font-color1, white));
      --sklearn-color-icon: #878787;
    }
  }

  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d {
    color: var(--sklearn-color-text);
  }

  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d pre {
    padding: 0;
  }

  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d input.sk-hidden--visually {
    border: 0;
    clip: rect(1px 1px 1px 1px);
    clip: rect(1px, 1px, 1px, 1px);
    height: 1px;
    margin: -1px;
    overflow: hidden;
    padding: 0;
    position: absolute;
    width: 1px;
  }

  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d div.sk-dashed-wrapped {
    border: 1px dashed var(--sklearn-color-line);
    margin: 0 0.4em 0.5em 0.4em;
    box-sizing: border-box;
    padding-bottom: 0.4em;
    background-color: var(--sklearn-color-background);
  }

  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d div.sk-container {
    /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
       but bootstrap.min.css set `[hidden] { display: none !important; }`
       so we also need the `!important` here to be able to override the
       default hidden behavior on the sphinx rendered scikit-learn.org.
       See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
    display: inline-block !important;
    position: relative;
  }

  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d div.sk-text-repr-fallback {
    display: none;
  }

  div.sk-parallel-item,
  div.sk-serial,
  div.sk-item {
    /* draw centered vertical line to link estimators */
    background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
    background-size: 2px 100%;
    background-repeat: no-repeat;
    background-position: center center;
  }

  /* Parallel-specific style estimator block */

  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d div.sk-parallel-item::after {
    content: "";
    width: 100%;
    border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
    flex-grow: 1;
  }

  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d div.sk-parallel {
    display: flex;
    align-items: stretch;
    justify-content: center;
    background-color: var(--sklearn-color-background);
    position: relative;
  }

  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d div.sk-parallel-item {
    display: flex;
    flex-direction: column;
  }

  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d div.sk-parallel-item:first-child::after {
    align-self: flex-end;
    width: 50%;
  }

  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d div.sk-parallel-item:last-child::after {
    align-self: flex-start;
    width: 50%;
  }

  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d div.sk-parallel-item:only-child::after {
    width: 0;
  }

  /* Serial-specific style estimator block */

  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d div.sk-serial {
    display: flex;
    flex-direction: column;
    align-items: center;
    background-color: var(--sklearn-color-background);
    padding-right: 1em;
    padding-left: 1em;
  }


  /* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
  clickable and can be expanded/collapsed.
  - Pipeline and ColumnTransformer use this feature and define the default style
  - Estimators will overwrite some part of the style using the `sk-estimator` class
  */

  /* Pipeline and ColumnTransformer style (default) */

  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d div.sk-toggleable {
    /* Default theme specific background. It is overwritten whether we have a
    specific estimator or a Pipeline/ColumnTransformer */
    background-color: var(--sklearn-color-background);
  }

  /* Toggleable label */
  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d label.sk-toggleable__label {
    cursor: pointer;
    display: block;
    width: 100%;
    margin-bottom: 0;
    padding: 0.5em;
    box-sizing: border-box;
    text-align: center;
  }

  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d label.sk-toggleable__label-arrow:before {
    /* Arrow on the left of the label */
    content: "‚ñ∏";
    float: left;
    margin-right: 0.25em;
    color: var(--sklearn-color-icon);
  }

  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d label.sk-toggleable__label-arrow:hover:before {
    color: var(--sklearn-color-text);
  }

  /* Toggleable content - dropdown */

  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d div.sk-toggleable__content {
    max-height: 0;
    max-width: 0;
    overflow: hidden;
    text-align: left;
    background-color: var(--sklearn-color-level-0);
  }

  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d div.sk-toggleable__content pre {
    margin: 0.2em;
    border-radius: 0.25em;
    color: var(--sklearn-color-text);
    background-color: var(--sklearn-color-level-0);
  }

  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d input.sk-toggleable__control:checked~div.sk-toggleable__content {
    /* Expand drop-down */
    max-height: 200px;
    max-width: 100%;
    overflow: auto;
  }

  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
    content: "‚ñæ";
  }

  /* Pipeline/ColumnTransformer-specific style */

  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
    color: var(--sklearn-color-text);
    background-color: var(--sklearn-color-level-2);
  }

  /* Estimator-specific style */

  /* Colorize estimator box */
  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
    /* unfitted */
    background-color: var(--sklearn-color-level-2);
  }

  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d div.sk-label label.sk-toggleable__label,
  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d div.sk-label label {
    /* The background is the default theme color */
    color: var(--sklearn-color-text-on-default-background);
  }

  /* On hover, darken the color of the background */
  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d div.sk-label:hover label.sk-toggleable__label {
    color: var(--sklearn-color-text);
    background-color: var(--sklearn-color-level-2);
  }

  /* Estimator label */

  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d div.sk-label label {
    font-family: monospace;
    font-weight: bold;
    display: inline-block;
    line-height: 1.2em;
  }

  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d div.sk-label-container {
    text-align: center;
  }

  /* Estimator-specific */
  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d div.sk-estimator {
    font-family: monospace;
    border: 1px dotted var(--sklearn-color-border-box);
    border-radius: 0.25em;
    box-sizing: border-box;
    margin-bottom: 0.5em;
    background-color: var(--sklearn-color-level-0);
  }

  /* on hover */
  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d div.sk-estimator:hover {
    background-color: var(--sklearn-color-level-2);
  }

  /* Specification for estimator info */

  .sk-estimator-doc-link,
  a:link.sk-estimator-doc-link,
  a:visited.sk-estimator-doc-link {
    float: right;
    font-size: smaller;
    line-height: 1em;
    font-family: monospace;
    background-color: var(--sklearn-color-background);
    border-radius: 1em;
    height: 1em;
    width: 1em;
    text-decoration: none !important;
    margin-left: 1ex;
    border: var(--sklearn-color-level-1) 1pt solid;
    color: var(--sklearn-color-level-1);
  }

  /* On hover */
  div.sk-estimator:hover .sk-estimator-doc-link:hover,
  .sk-estimator-doc-link:hover,
  div.sk-label-container:hover .sk-estimator-doc-link:hover,
  .sk-estimator-doc-link:hover {
    background-color: var(--sklearn-color-level-3);
    color: var(--sklearn-color-background);
    text-decoration: none;
  }

  /* Span, style for the box shown on hovering the info icon */
  .sk-estimator-doc-link span {
    display: none;
    z-index: 9999;
    position: relative;
    font-weight: normal;
    right: .2ex;
    padding: .5ex;
    margin: .5ex;
    width: min-content;
    min-width: 20ex;
    max-width: 50ex;
    color: var(--sklearn-color-text);
    box-shadow: 2pt 2pt 4pt #999;
    background: var(--sklearn-color-level-0);
    border: .5pt solid var(--sklearn-color-level-3);
  }

  .sk-estimator-doc-link:hover span {
    display: block;
  }

  /* "?"-specific style due to the `<a>` HTML tag */

  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d a.estimator_doc_link {
    float: right;
    font-size: 1rem;
    line-height: 1em;
    font-family: monospace;
    background-color: var(--sklearn-color-background);
    border-radius: 1rem;
    height: 1rem;
    width: 1rem;
    text-decoration: none;
    color: var(--sklearn-color-level-1);
    border: var(--sklearn-color-level-1) 1pt solid;
  }

  /* On hover */
  #sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d a.estimator_doc_link:hover {
    background-color: var(--sklearn-color-level-3);
    color: var(--sklearn-color-background);
    text-decoration: none;
  }
</style>
<div id='sk-28e0555f-5a2f-4a4c-97ca-7859739ab67d' class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Prophetverse(exogenous_effects=[(&#x27;yearly_seasonality&#x27;,
                                 LinearFourierSeasonality(effect_mode=&#x27;multiplicative&#x27;,
                                                          fourier_terms_list=[5],
                                                          freq=&#x27;D&#x27;,
                                                          prior_scale=0.1,
                                                          sp_list=[365.25]),
                                 None),
                                (&#x27;weekly_seasonality&#x27;,
                                 LinearFourierSeasonality(effect_mode=&#x27;multiplicative&#x27;,
                                                          fourier_terms_list=[3],
                                                          freq=&#x27;D&#x27;,
                                                          prior_scale=0.05,
                                                          sp_list=[7]),
                                 None),
                                (&#x27;ad_spend_search&#x27;,
                                 LiftExp...
2000-01-04           99764.344046
2000-01-05           88181.843186
...                           ...
2004-12-28           81379.372321
2004-12-29           87020.551262
2004-12-30           85365.036257
2004-12-31           83767.855979
2005-01-01           81874.950642

[1828 rows x 1 columns]),
                                 None)],
             inference_engine=MAPInferenceEngine(num_steps=5000,
                                                 optimizer=LBFGSSolver(max_linesearch_steps=200,
                                                                       memory_size=200)),
             trend=PiecewiseLinearTrend(changepoint_interval=100))</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class='sk-label-container'><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('d1484c80-ab4d-46e6-b352-146ef92ff285') type="checkbox" ><label for=UUID('d1484c80-ab4d-46e6-b352-146ef92ff285') class='sk-toggleable__label sk-toggleable__label-arrow'>Prophetverse</label><div class="sk-toggleable__content"><pre>Prophetverse(exogenous_effects=[(&#x27;yearly_seasonality&#x27;,
                                 LinearFourierSeasonality(effect_mode=&#x27;multiplicative&#x27;,
                                                          fourier_terms_list=[5],
                                                          freq=&#x27;D&#x27;,
                                                          prior_scale=0.1,
                                                          sp_list=[365.25]),
                                 None),
                                (&#x27;weekly_seasonality&#x27;,
                                 LinearFourierSeasonality(effect_mode=&#x27;multiplicative&#x27;,
                                                          fourier_terms_list=[3],
                                                          freq=&#x27;D&#x27;,
                                                          prior_scale=0.05,
                                                          sp_list=[7]),
                                 None),
                                (&#x27;ad_spend_search&#x27;,
                                 LiftExp...
2000-01-04           99764.344046
2000-01-05           88181.843186
...                           ...
2004-12-28           81379.372321
2004-12-29           87020.551262
2004-12-30           85365.036257
2004-12-31           83767.855979
2005-01-01           81874.950642

[1828 rows x 1 columns]),
                                 None)],
             inference_engine=MAPInferenceEngine(num_steps=5000,
                                                 optimizer=LBFGSSolver(max_linesearch_steps=200,
                                                                       memory_size=200)),
             trend=PiecewiseLinearTrend(changepoint_interval=100))</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class='sk-label-container'><div class="sk-label sk-toggleable"><label>effects</label></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class='sk-item'><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('83cb3771-e354-469f-90ec-9caa60bb3346') type="checkbox" ><label for=UUID('83cb3771-e354-469f-90ec-9caa60bb3346') class='sk-toggleable__label sk-toggleable__label-arrow'>PiecewiseLinearTrend</label><div class="sk-toggleable__content"><pre>PiecewiseLinearTrend(changepoint_interval=100)</pre></div></div></div><div class='sk-item'><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('b455f6e9-432d-4a57-ba0c-490697c236c5') type="checkbox" ><label for=UUID('b455f6e9-432d-4a57-ba0c-490697c236c5') class='sk-toggleable__label sk-toggleable__label-arrow'>LinearFourierSeasonality</label><div class="sk-toggleable__content"><pre>LinearFourierSeasonality(effect_mode=&#x27;multiplicative&#x27;, fourier_terms_list=[5],
                         freq=&#x27;D&#x27;, prior_scale=0.1, sp_list=[365.25])</pre></div></div></div><div class='sk-item'><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('af6d8727-1ce1-4bea-acc7-4187ef55ede3') type="checkbox" ><label for=UUID('af6d8727-1ce1-4bea-acc7-4187ef55ede3') class='sk-toggleable__label sk-toggleable__label-arrow'>LinearFourierSeasonality</label><div class="sk-toggleable__content"><pre>LinearFourierSeasonality(effect_mode=&#x27;multiplicative&#x27;, fourier_terms_list=[3],
                         freq=&#x27;D&#x27;, prior_scale=0.05, sp_list=[7])</pre></div></div></div><div class="sk-item sk-dashed-wrapped"><div class='sk-label-container'><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('b2586caf-2475-4fc0-bada-5f1416cb81c1') type="checkbox" ><label for=UUID('b2586caf-2475-4fc0-bada-5f1416cb81c1') class='sk-toggleable__label sk-toggleable__label-arrow'>ad_spend_search</label><div class="sk-toggleable__content"><pre>LiftExperimentLikelihood(effect=ChainedEffects(steps=[(&#x27;adstock&#x27;,
                                                       GeometricAdstockEffect()),
                                                      (&#x27;saturation&#x27;,
                                                       HillEffect(effect_mode=&#x27;additive&#x27;,
                                                                  half_max_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x31a3992d0 with batch shape () and event shape ()&gt;,
                                                                  input_scale=1000000.0,
                                                                  max_effect_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x315cee2...
2004-07-17  1.025315  67354.435955  92061.937569
2002-10-21  1.356352  19342.497501  25654.928003
2001-09-17  1.007672  66940.425562  60975.537748
2004-11-30  1.130302  27602.264625  34344.815009
2004-12-26  1.022175  38511.161989  39737.886356
2001-09-20  1.023819  64080.310879  78594.396432
2002-05-16  1.015904  65554.939615  67996.877272
2003-10-31  1.014672  53044.156616  53463.620520,
                         prior_scale=0.01)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class='sk-label-container'><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('6d790a6f-a7ba-4938-935a-965d06a0cb73') type="checkbox" ><label for=UUID('6d790a6f-a7ba-4938-935a-965d06a0cb73') class='sk-toggleable__label sk-toggleable__label-arrow'>effect: ChainedEffects</label><div class="sk-toggleable__content"><pre>ChainedEffects(steps=[(&#x27;adstock&#x27;, GeometricAdstockEffect()),
                      (&#x27;saturation&#x27;,
                       HillEffect(effect_mode=&#x27;additive&#x27;,
                                  half_max_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x31a3992d0 with batch shape () and event shape ()&gt;,
                                  input_scale=1000000.0,
                                  max_effect_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x315cee290 with batch shape () and event shape ()&gt;,
                                  slope_prior=&lt;numpyro.distributions.continuous.InverseGamma object at 0x31ab02090 with batch shape () and event shape ()&gt;))])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class='sk-item'><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('f3506bc2-25d5-4e84-a318-d0b6d3414d8d') type="checkbox" ><label for=UUID('f3506bc2-25d5-4e84-a318-d0b6d3414d8d') class='sk-toggleable__label sk-toggleable__label-arrow'>GeometricAdstockEffect</label><div class="sk-toggleable__content"><pre>GeometricAdstockEffect()</pre></div></div></div><div class='sk-item'><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('de4ce821-2d4e-417a-aa55-7141866c420c') type="checkbox" ><label for=UUID('de4ce821-2d4e-417a-aa55-7141866c420c') class='sk-toggleable__label sk-toggleable__label-arrow'>HillEffect</label><div class="sk-toggleable__content"><pre>HillEffect(effect_mode=&#x27;additive&#x27;,
           half_max_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x31a3992d0 with batch shape () and event shape ()&gt;,
           input_scale=1000000.0,
           max_effect_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x315cee290 with batch shape () and event shape ()&gt;,
           slope_prior=&lt;numpyro.distributions.continuous.InverseGamma object at 0x31ab02090 with batch shape () and event shape ()&gt;)</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item sk-dashed-wrapped"><div class='sk-label-container'><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('3f1b8264-3f51-4952-9110-603340131ca8') type="checkbox" ><label for=UUID('3f1b8264-3f51-4952-9110-603340131ca8') class='sk-toggleable__label sk-toggleable__label-arrow'>ad_spend_social_media</label><div class="sk-toggleable__content"><pre>LiftExperimentLikelihood(effect=ChainedEffects(steps=[(&#x27;adstock&#x27;,
                                                       GeometricAdstockEffect()),
                                                      (&#x27;saturation&#x27;,
                                                       HillEffect(effect_mode=&#x27;additive&#x27;,
                                                                  half_max_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x31a3992d0 with batch shape () and event shape ()&gt;,
                                                                  input_scale=1000000.0,
                                                                  max_effect_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x315cee2...
2004-03-12  0.993162   23495.675246   24478.491907
2001-10-29  0.984360   44379.074948   37313.349224
2002-05-30  0.989024   27726.620636   31907.853065
2003-01-02  1.010906    1773.725603    1554.825745
2002-01-29  0.989574   39214.672134   56545.763983
2001-05-19  0.985555   46499.449093   40163.797819
2002-11-15  1.200436    1451.982807    1752.828046
2001-08-11  0.984737   64502.380804   62625.006901,
                         prior_scale=0.01)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class='sk-label-container'><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('9893b202-5bfa-4333-90c1-59791000e40b') type="checkbox" ><label for=UUID('9893b202-5bfa-4333-90c1-59791000e40b') class='sk-toggleable__label sk-toggleable__label-arrow'>effect: ChainedEffects</label><div class="sk-toggleable__content"><pre>ChainedEffects(steps=[(&#x27;adstock&#x27;, GeometricAdstockEffect()),
                      (&#x27;saturation&#x27;,
                       HillEffect(effect_mode=&#x27;additive&#x27;,
                                  half_max_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x31a3992d0 with batch shape () and event shape ()&gt;,
                                  input_scale=1000000.0,
                                  max_effect_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x315cee290 with batch shape () and event shape ()&gt;,
                                  slope_prior=&lt;numpyro.distributions.continuous.InverseGamma object at 0x31ab02090 with batch shape () and event shape ()&gt;))])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class='sk-item'><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('17ad865f-eef9-48c7-ae51-70c2f707e94c') type="checkbox" ><label for=UUID('17ad865f-eef9-48c7-ae51-70c2f707e94c') class='sk-toggleable__label sk-toggleable__label-arrow'>GeometricAdstockEffect</label><div class="sk-toggleable__content"><pre>GeometricAdstockEffect()</pre></div></div></div><div class='sk-item'><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('c7504f37-e958-428c-a598-affdb87b196f') type="checkbox" ><label for=UUID('c7504f37-e958-428c-a598-affdb87b196f') class='sk-toggleable__label sk-toggleable__label-arrow'>HillEffect</label><div class="sk-toggleable__content"><pre>HillEffect(effect_mode=&#x27;additive&#x27;,
           half_max_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x31a3992d0 with batch shape () and event shape ()&gt;,
           input_scale=1000000.0,
           max_effect_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x315cee290 with batch shape () and event shape ()&gt;,
           slope_prior=&lt;numpyro.distributions.continuous.InverseGamma object at 0x31ab02090 with batch shape () and event shape ()&gt;)</pre></div></div></div></div></div></div></div></div></div></div><div class='sk-item'><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('a313cc01-cb8d-4a35-a908-5e1fdc2d5d45') type="checkbox" ><label for=UUID('a313cc01-cb8d-4a35-a908-5e1fdc2d5d45') class='sk-toggleable__label sk-toggleable__label-arrow'>ExactLikelihood</label><div class="sk-toggleable__content"><pre>ExactLikelihood(effect_name=&#x27;ad_spend_search&#x27;, prior_scale=0.01,
                reference_df=            ad_spend_search
2000-01-01     1.022147e+06
2000-01-02     8.887188e+05
2000-01-03     1.066563e+06
2000-01-04     1.085466e+06
2000-01-05     7.984178e+05
...                     ...
2004-12-28     9.790619e+05
2004-12-29     8.292320e+05
2004-12-30     9.590487e+05
2004-12-31     9.845138e+05
2005-01-01     1.054480e+06

[1828 rows x 1 columns])</pre></div></div></div><div class='sk-item'><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('760e0ca6-7ab7-4901-b3fc-03ddf71a4e25') type="checkbox" ><label for=UUID('760e0ca6-7ab7-4901-b3fc-03ddf71a4e25') class='sk-toggleable__label sk-toggleable__label-arrow'>ExactLikelihood</label><div class="sk-toggleable__content"><pre>ExactLikelihood(effect_name=&#x27;ad_spend_social_media&#x27;, prior_scale=0.01,
                reference_df=            ad_spend_social_media
2000-01-01           88305.141575
2000-01-02           96298.364313
2000-01-03          106375.410968
2000-01-04           99764.344046
2000-01-05           88181.843186
...                           ...
2004-12-28           81379.372321
2004-12-29           87020.551262
2004-12-30           85365.036257
2004-12-31           83767.855979
2005-01-01           81874.950642

[1828 rows x 1 columns])</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class='sk-label-container'><div class="sk-label sk-toggleable"><label>inference_engine</label></div></div><div class="sk-serial"><div class='sk-item'><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id=UUID('9e52b8e2-d826-4048-8b25-5b48102ee257') type="checkbox" ><label for=UUID('9e52b8e2-d826-4048-8b25-5b48102ee257') class='sk-toggleable__label sk-toggleable__label-arrow'>MAPInferenceEngine</label><div class="sk-toggleable__content"><pre>MAPInferenceEngine(num_steps=5000,
                   optimizer=LBFGSSolver(max_linesearch_steps=200,
                                         memory_size=200))</pre></div></div></div></div></div></div></div></div></div></div>

<div class="language-python highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">components_umm</span> <span class="o">=</span> <span class="n">model_umm</span><span class="o">.</span><span class="n">predict_components</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">fh</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="c1"># Compare all 3 models</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ad_spend_search&quot;</span><span class="p">,</span> <span class="s2">&quot;ad_spend_social_media&quot;</span><span class="p">]):</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">channel</span><span class="p">],</span> <span class="n">y_pred_components</span><span class="p">[</span><span class="n">channel</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Baseline&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">channel</span><span class="p">],</span> <span class="n">components_lift</span><span class="p">[</span><span class="n">channel</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;With Lift Test&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">channel</span><span class="p">],</span> <span class="n">components_umm</span><span class="p">[</span><span class="n">channel</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;With Attribution&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">channel</span><span class="p">],</span> <span class="n">true_components</span><span class="p">[</span><span class="n">channel</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;True Effect&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></code></pre></div>
<p class="cell-output-title jp-RenderedText jp-OutputArea-output">Output: <span class="cell-output-count">[18]</span></p>

<p><img alt="png" src="index_files/output_28_0.png" /></p>
<p>Even better! And, due to sktime-like interface, wrapping and adding new
effects is easy.</p>
<h2 id="final-thoughts-toward-unified-marketing-measurement">Final Thoughts: Toward Unified Marketing Measurement</h2>
<p>‚úÖ <strong>What we learned</strong>:</p>
<ol>
<li>
<p>Adstock + saturation are essential to capture media dynamics.</p>
</li>
<li>
<p>Good predictions ‚â† good attribution.</p>
</li>
<li>
<p>Causal data like lift tests can <strong>correct</strong> misattribution.</p>
</li>
<li>
<p>Attribution signals add further constraints.</p>
</li>
</ol>
<p>üõ†Ô∏è <strong>Use this when</strong>:</p>
<ul>
<li>
<p>Channels are correlated ‚Üí Use lift tests.</p>
</li>
<li>
<p>You have granular model output ‚Üí Add attribution likelihoods.</p>
</li>
<li>
<p>Everytime you have access to such data.</p>
</li>
</ul>
<p>üß™ <strong>Model selection tip</strong>:
Always validate <strong>causal logic</strong>, not just fit quality. A sharp-looking forecast might hide very bad ROI conclusions.</p>
<p>With Prophetverse, you can <strong>combine observational, experimental, and model-based signals</strong> into one coherent MMM+UMM pipeline.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "navigation.tabs", "navigation.instant", "navigation.instant.progress", "search", "toc.integrate", "toc.follow"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>