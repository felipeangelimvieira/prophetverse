<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.34">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Learn how to use saturation and adstock transformations in Prophetverse to model diminishing returns and delayed effects of marketing activities.">

<title>Saturation and Adstock ‚Äì prophetverse</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../static/logo-removebg.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-c8ad9e5dbd60b7b70b38521ab19b7da4.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-80522642ec485bfe782ddd35948259a8.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 5,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../styles.css">
<link rel="stylesheet" href="../reference/_styles-quartodoc.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../static/logo-removebg.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">prophetverse</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tutorials-üìö" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Tutorials üìö</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tutorials-üìö">    
        <li>
    <a class="dropdown-item" href="../tutorials/univariate.html">
 <span class="dropdown-text">Univariate forecasting</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../tutorials/tuning.html">
 <span class="dropdown-text">Hyperparameter tuning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../tutorials/hierarchical.html">
 <span class="dropdown-text">Hierarchical Bayesian Model</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../tutorials/count_data.html">
 <span class="dropdown-text">Count data forecasting</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-how-to-üõ†Ô∏è" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">How To üõ†Ô∏è</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-how-to-üõ†Ô∏è">    
        <li>
    <a class="dropdown-item" href="../howto/effect_api_intro.html">
 <span class="dropdown-text">Introduction to Effects</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../howto/custom_trend.html">
 <span class="dropdown-text">Custom trend</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../howto/custom_effects.html">
 <span class="dropdown-text">Custom exogenous effect</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../howto/composite_effects.html">
 <span class="dropdown-text">Creating composite effects</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../howto/beta_percentage_forecast.html">
 <span class="dropdown-text">Forecasting percentages</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../mmm"> 
<span class="menu-text">Marketing Mix Modeling üöÄ</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../the-theory.html"> 
<span class="menu-text">Mathematical Formulation üìñ</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../reference"> 
<span class="menu-text">API Reference</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">‚ú®</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-">    
        <li>
    <a class="dropdown-item" href="../prompts/custom_effects.html">
 <span class="dropdown-text">Custom Effect Prompt</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-github" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-github">    
        <li>
    <a class="dropdown-item" href="https://github.com/felipeangelimvieira/prophetverse">
 <span class="dropdown-text">Source Code</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../development.html">
 <span class="dropdown-text">Development guide</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-discord" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-discord" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-discord">    
        <li>
    <a class="dropdown-item" href="https://discord.com/channels/1075852648688930887/1372332867111358504">
 <span class="dropdown-text">Join the community</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-version" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Version</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-version">    
        <li>
    <a class="dropdown-item" href="../latest">
 <span class="dropdown-text">latest</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://prophetverse.com/0.6.0">
 <span class="dropdown-text">0.6.0</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../mmm/saturation_and_adstock.html">Saturation and Adstock</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../mmm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../mmm/getting_familiar.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basics of MMM with Prophetverse</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../mmm/saturation_and_adstock.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Saturation and Adstock</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../mmm/fitting_and_calibration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Fitting, calibrating and Unified Marketing Measurement</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../mmm/budget_allocation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Budget Optimization</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#loading-the-dataset" id="toc-loading-the-dataset" class="nav-link active" data-scroll-target="#loading-the-dataset">Loading the dataset</a></li>
  <li><a href="#saturations" id="toc-saturations" class="nav-link" data-scroll-target="#saturations">Saturations</a>
  <ul class="collapse">
  <li><a href="#visualizing-prior-predictive-distributions" id="toc-visualizing-prior-predictive-distributions" class="nav-link" data-scroll-target="#visualizing-prior-predictive-distributions">Visualizing prior predictive distributions</a></li>
  </ul></li>
  <li><a href="#adstock" id="toc-adstock" class="nav-link" data-scroll-target="#adstock">Adstock</a></li>
  <li><a href="#combining-saturation-and-adstock" id="toc-combining-saturation-and-adstock" class="nav-link" data-scroll-target="#combining-saturation-and-adstock">Combining Saturation and Adstock</a></li>
  <li><a href="#extra-visualizing-the-impulse-response-of-adstock" id="toc-extra-visualizing-the-impulse-response-of-adstock" class="nav-link" data-scroll-target="#extra-visualizing-the-impulse-response-of-adstock">Extra: Visualizing the impulse response of adstock</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Saturation and Adstock</h1>
</div>

<div>
  <div class="description">
    <em>Learn how to use saturation and adstock transformations in Prophetverse to model diminishing returns and delayed effects of marketing activities.</em>
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>There are many available effects available by default on Prophetverse. To get a glimpse of them, you can query <code>all_objects</code> from <code>skbase.lookup</code>:</p>
<div id="75e17228" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> skbase.lookup <span class="im">import</span> all_objects</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> prophetverse.effects <span class="im">import</span> BaseEffect</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>all_objects(object_types<span class="op">=</span>[BaseEffect], package_name<span class="op">=</span><span class="st">"prophetverse"</span>, as_dataframe<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/tqdm/auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
  from .autonotebook import tqdm as notebook_tqdm</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">object</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>BetaTargetLikelihood</td>
<td>&lt;class 'prophetverse.effects.target.univariate...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>ChainedEffects</td>
<td>&lt;class 'prophetverse.effects.chain.ChainedEffe...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Constant</td>
<td>&lt;class 'prophetverse.effects.constant.Constant'&gt;</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>ExactLikelihood</td>
<td>&lt;class 'prophetverse.effects.exact_likelihood....</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>FlatTrend</td>
<td>&lt;class 'prophetverse.effects.trend.flat.FlatTr...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>GammaTargetLikelihood</td>
<td>&lt;class 'prophetverse.effects.target.univariate...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>GeometricAdstockEffect</td>
<td>&lt;class 'prophetverse.effects.adstock.Geometric...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>HillEffect</td>
<td>&lt;class 'prophetverse.effects.hill.HillEffect'&gt;</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>HurdleTargetLikelihood</td>
<td>&lt;class 'prophetverse.effects.target.hurdle.Hur...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>IgnoreInput</td>
<td>&lt;class 'prophetverse.effects.ignore_input.Igno...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>LiftExperimentLikelihood</td>
<td>&lt;class 'prophetverse.effects.lift_likelihood.L...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>LinearEffect</td>
<td>&lt;class 'prophetverse.effects.linear.LinearEffe...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>LinearFourierSeasonality</td>
<td>&lt;class 'prophetverse.effects.fourier.LinearFou...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>LogEffect</td>
<td>&lt;class 'prophetverse.effects.log.LogEffect'&gt;</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>MichaelisMentenEffect</td>
<td>&lt;class 'prophetverse.effects.michaelis_menten....</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>MultivariateNormal</td>
<td>&lt;class 'prophetverse.effects.target.multivaria...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>NegativeBinomialTargetLikelihood</td>
<td>&lt;class 'prophetverse.effects.target.univariate...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>NormalTargetLikelihood</td>
<td>&lt;class 'prophetverse.effects.target.univariate...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>PanelBHLinearEffect</td>
<td>&lt;class 'prophetverse.effects.linear.PanelBHLin...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>PiecewiseLinearTrend</td>
<td>&lt;class 'prophetverse.effects.trend.piecewise.P...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>PiecewiseLogisticTrend</td>
<td>&lt;class 'prophetverse.effects.trend.piecewise.P...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>TargetLikelihood</td>
<td>&lt;class 'prophetverse.effects.target.univariate...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>WeibullAdstockEffect</td>
<td>&lt;class 'prophetverse.effects.adstock.WeibullAd...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Not bad, right? The best part is that you can combine them in a flexible way to create your own custom effects, and even create your own effects if you want to. Below, we showcase some interesting combinations you can use, and how to visualize their prior predictive distribution.</p>
<section id="loading-the-dataset" class="level2">
<h2 class="anchored" data-anchor-id="loading-the-dataset">Loading the dataset</h2>
<p>We load a synthetic dataset with daily frequency, to use in this example.</p>
<div id="41374039" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> prophetverse.datasets._mmm.dataset1 <span class="im">import</span> get_dataset</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>y, X <span class="op">=</span> get_dataset(return_y_and_X_only<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>y.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>2000-01-01    10815512.0
2000-01-02    11120677.0
2000-01-03    11260387.0
2000-01-04    11322533.0
2000-01-05    11321180.0
Freq: D, dtype: float32</code></pre>
</div>
</div>
<div id="6f1ed7e2" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>X.plot.line(ax<span class="op">=</span>ax)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="saturation_and_adstock_files/figure-html/cell-5-output-1.png" width="827" height="333" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="saturations" class="level2">
<h2 class="anchored" data-anchor-id="saturations">Saturations</h2>
<p>The most common saturation functions are Hill, Michaelis-Menten, and Logarithmic. They are all available in Prophetverse:</p>
<div id="2e3769fd" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> prophetverse.effects <span class="im">import</span> MichaelisMentenEffect, HillEffect, LogEffect</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpyro</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpyro <span class="im">import</span> distributions <span class="im">as</span> dist</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>mm_saturation <span class="op">=</span> MichaelisMentenEffect(</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    effect_mode<span class="op">=</span><span class="st">"additive"</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    max_effect_prior<span class="op">=</span>dist.HalfNormal(<span class="fl">0.4</span>),</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    half_saturation_prior<span class="op">=</span>dist.HalfNormal(<span class="dv">40000</span>),</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>log_saturation <span class="op">=</span> LogEffect(</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    effect_mode<span class="op">=</span><span class="st">"additive"</span>,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    scale_prior<span class="op">=</span>dist.HalfNormal(<span class="fl">0.2</span>),</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    rate_prior<span class="op">=</span>dist.HalfNormal(<span class="fl">0.0001</span>),</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>hill_saturation <span class="op">=</span> HillEffect(</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    effect_mode<span class="op">=</span><span class="st">"additive"</span>,</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    max_effect_prior<span class="op">=</span>dist.HalfNormal(<span class="fl">0.4</span>),</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    half_max_prior<span class="op">=</span>dist.HalfNormal(<span class="dv">40000</span>),</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    slope_prior<span class="op">=</span>dist.InverseGamma(<span class="dv">4</span>, <span class="dv">2</span>),</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>mm_saturation</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<style>#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 {color: black;background-color: white;}#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 pre{padding: 0;}#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 div.sk-toggleable {background-color: white;}#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 label.sk-toggleable__label-arrow:before {content: "‚ñ∏";float: left;margin-right: 0.25em;color: #696969;}#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "‚ñæ";}#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 div.sk-estimator:hover {background-color: #d4ebff;}#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 div.sk-item {z-index: 1;}#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 div.sk-parallel-item:only-child::after {width: 0;}#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06 div.sk-text-repr-fallback {display: none;}</style><div id="sk-e9172630-8b8f-42b3-9a9a-9dc1914f7d06" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>MichaelisMentenEffect(effect_mode='additive',
                      half_saturation_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x7ff2dcc4ef90 with batch shape () and event shape ()&gt;,
                      max_effect_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x7ff249fc5c50 with batch shape () and event shape ()&gt;)</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="UUID('564cab49-cc1a-4269-a15e-e2de6b7a61de')" type="checkbox" checked=""><label for="UUID('564cab49-cc1a-4269-a15e-e2de6b7a61de')" class="sk-toggleable__label sk-toggleable__label-arrow">MichaelisMentenEffect</label><div class="sk-toggleable__content"><pre>MichaelisMentenEffect(effect_mode='additive',
                      half_saturation_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x7ff2dcc4ef90 with batch shape () and event shape ()&gt;,
                      max_effect_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x7ff249fc5c50 with batch shape () and event shape ()&gt;)</pre></div></div></div></div></div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Since Prophetverse and all effects are estimators, you can set and inspect the hyperparameters through <code>get_params</code> and <code>set_params</code> methods, and of course plug them into an automated hyperparameter tuning workflow. Checkout our <a href="../tutorials/tuning.html">Hyperparameter Tuning tutorial</a> for more details.</p>
</div>
</div>
<section id="visualizing-prior-predictive-distributions" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-prior-predictive-distributions">Visualizing prior predictive distributions</h3>
<p>To get a better sense of how these effects behave, we can visualize their prior predictive distributions using the <code>plot_prior_predictive</code> utility from <code>prophetverse.utils.plotting</code>.</p>
<p>We first visualize how the output of the effect behaves with respect to the input:</p>
<div id="4c84ada6" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> prophetverse.utils.plotting <span class="im">import</span> plot_prior_predictive</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plot_prior_predictive(</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    mm_saturation,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    X<span class="op">=</span>X[[<span class="st">"ad_spend_search"</span>]],</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    mode<span class="op">=</span><span class="st">"ad_spend_search"</span>,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    matplotlib_kwargs<span class="op">=</span><span class="bu">dict</span>(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">3</span>)),</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="saturation_and_adstock_files/figure-html/cell-7-output-1.png" width="489" height="259" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>And through time, when applied to a time series:</p>
<div id="1276a8a6" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plot_prior_predictive(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    mm_saturation,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    X<span class="op">=</span>X[[<span class="st">"ad_spend_search"</span>]],</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    mode<span class="op">=</span><span class="st">"time"</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    matplotlib_kwargs<span class="op">=</span><span class="bu">dict</span>(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">3</span>)),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="saturation_and_adstock_files/figure-html/cell-8-output-1.png" width="489" height="259" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="adstock" class="level2">
<h2 class="anchored" data-anchor-id="adstock">Adstock</h2>
<p>To model the delayed effect of advertising on sales, we can use adstock transformations.</p>
<p>Let‚Äôs visualize first how Weibull Adstock behaves when applied to the input:</p>
<div id="55dbae78" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> prophetverse <span class="im">import</span> GeometricAdstockEffect, WeibullAdstockEffect</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>adstock <span class="op">=</span> WeibullAdstockEffect(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    scale_prior<span class="op">=</span>dist.HalfNormal(<span class="dv">10</span>),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    concentration_prior<span class="op">=</span>dist.HalfNormal(<span class="dv">2</span>),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plot_prior_predictive(</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    adstock,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    X<span class="op">=</span>X[[<span class="st">"ad_spend_search"</span>]].iloc[<span class="dv">100</span>:<span class="dv">180</span>],</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    mode<span class="op">=</span><span class="st">"time"</span>,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    matplotlib_kwargs<span class="op">=</span><span class="bu">dict</span>(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">3</span>)),</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>X[[<span class="st">"ad_spend_search"</span>]].iloc[<span class="dv">100</span>:<span class="dv">180</span>].plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">"tab:orange"</span>)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> line, label <span class="kw">in</span> <span class="bu">zip</span>(ax.lines, [<span class="st">"After Adstock"</span>, <span class="st">"Input Data"</span>]):</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    line.set_label(label)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="saturation_and_adstock_files/figure-html/cell-9-output-1.png" width="515" height="265" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>And how Geometric Adstock behaves:</p>
<div id="14beb1ae" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>adstock <span class="op">=</span> GeometricAdstockEffect(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    decay_prior<span class="op">=</span>dist.Beta(<span class="dv">10</span>, <span class="dv">10</span>),</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set normalize=True if you want an impulse of size 1 to have total</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cumulative mass 1 over infinite horizon (weights sum to 1)</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    normalize<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plot_prior_predictive(</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    adstock,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    X<span class="op">=</span>X[[<span class="st">"ad_spend_search"</span>]],</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    mode<span class="op">=</span><span class="st">"time"</span>,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    matplotlib_kwargs<span class="op">=</span><span class="bu">dict</span>(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">3</span>)),</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>X[[<span class="st">"ad_spend_search"</span>]].plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">"tab:orange"</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>ax.<span class="bu">set</span>(xlim<span class="op">=</span>(<span class="st">"2000-04-15"</span>, <span class="st">"2000-07-15"</span>), ylim<span class="op">=</span>(<span class="dv">80_000</span>, <span class="dv">110_000</span>))</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> line, label <span class="kw">in</span> <span class="bu">zip</span>(ax.lines, [<span class="st">"After Adstock"</span>, <span class="st">"Input Data"</span>]):</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    line.set_label(label)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="saturation_and_adstock_files/figure-html/cell-10-output-1.png" width="531" height="270" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="combining-saturation-and-adstock" class="level2">
<h2 class="anchored" data-anchor-id="combining-saturation-and-adstock">Combining Saturation and Adstock</h2>
<p>And you can of course compose them! Use <code>ChainedEffects</code> to combine multiple effects in a sequence. Below, we combine Michaelis-Menten saturation with Weibull Adstock. You</p>
<div id="bdacce38" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> prophetverse <span class="im">import</span> ChainedEffects</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>saturation_with_adstock <span class="op">=</span> ChainedEffects(</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    steps<span class="op">=</span>[</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        (</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"adstock_on_investment"</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>            WeibullAdstockEffect(</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                scale_prior<span class="op">=</span>dist.HalfNormal(<span class="dv">2</span>),</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>                concentration_prior<span class="op">=</span>dist.HalfNormal(<span class="dv">2</span>),</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        (<span class="st">"saturation"</span>, mm_saturation),</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>        (</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">"adstock_on_output"</span>,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>            WeibullAdstockEffect(</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>                scale_prior<span class="op">=</span>dist.HalfNormal(<span class="dv">2</span>),</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>                concentration_prior<span class="op">=</span>dist.HalfNormal(<span class="dv">2</span>),</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>saturation_with_adstock</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<style>#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 {color: black;background-color: white;}#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 pre{padding: 0;}#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 div.sk-toggleable {background-color: white;}#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 label.sk-toggleable__label-arrow:before {content: "‚ñ∏";float: left;margin-right: 0.25em;color: #696969;}#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "‚ñæ";}#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 div.sk-estimator:hover {background-color: #d4ebff;}#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 div.sk-item {z-index: 1;}#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 div.sk-parallel-item:only-child::after {width: 0;}#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4 div.sk-text-repr-fallback {display: none;}</style><div id="sk-14b5fa2b-c348-40b7-8a93-1ab8dbcc79e4" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>ChainedEffects(steps=[('adstock_on_investment',
                       WeibullAdstockEffect(concentration_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x7ff249c34290 with batch shape () and event shape ()&gt;,
                                            scale_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x7ff249f957d0 with batch shape () and event shape ()&gt;)),
                      ('saturation',
                       MichaelisMentenEffect(effect_mode='a...
                                             max_effect_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x7ff249fc5c50 with batch shape () and event shape ()&gt;)),
                      ('adstock_on_output',
                       WeibullAdstockEffect(concentration_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x7ff249e0c790 with batch shape () and event shape ()&gt;,
                                            scale_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x7ff28c725a90 with batch shape () and event shape ()&gt;))])</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="UUID('22d6cbfd-985e-4397-88f9-f35aa352f2db')" type="checkbox"><label for="UUID('22d6cbfd-985e-4397-88f9-f35aa352f2db')" class="sk-toggleable__label sk-toggleable__label-arrow">ChainedEffects</label><div class="sk-toggleable__content"><pre>ChainedEffects(steps=[('adstock_on_investment',
                       WeibullAdstockEffect(concentration_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x7ff249c34290 with batch shape () and event shape ()&gt;,
                                            scale_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x7ff249f957d0 with batch shape () and event shape ()&gt;)),
                      ('saturation',
                       MichaelisMentenEffect(effect_mode='a...
                                             max_effect_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x7ff249fc5c50 with batch shape () and event shape ()&gt;)),
                      ('adstock_on_output',
                       WeibullAdstockEffect(concentration_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x7ff249e0c790 with batch shape () and event shape ()&gt;,
                                            scale_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x7ff28c725a90 with batch shape () and event shape ()&gt;))])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="UUID('0316a833-4bd4-4106-b6b8-30091b52e580')" type="checkbox"><label for="UUID('0316a833-4bd4-4106-b6b8-30091b52e580')" class="sk-toggleable__label sk-toggleable__label-arrow">WeibullAdstockEffect</label><div class="sk-toggleable__content"><pre>WeibullAdstockEffect(concentration_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x7ff249c34290 with batch shape () and event shape ()&gt;,
                     scale_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x7ff249f957d0 with batch shape () and event shape ()&gt;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="UUID('12d79db8-af23-43fa-b982-85c99b33db5c')" type="checkbox"><label for="UUID('12d79db8-af23-43fa-b982-85c99b33db5c')" class="sk-toggleable__label sk-toggleable__label-arrow">MichaelisMentenEffect</label><div class="sk-toggleable__content"><pre>MichaelisMentenEffect(effect_mode='additive',
                      half_saturation_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x7ff2dcc4ef90 with batch shape () and event shape ()&gt;,
                      max_effect_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x7ff249fc5c50 with batch shape () and event shape ()&gt;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="UUID('a58b3a07-655f-416c-9564-350058fece54')" type="checkbox"><label for="UUID('a58b3a07-655f-416c-9564-350058fece54')" class="sk-toggleable__label sk-toggleable__label-arrow">WeibullAdstockEffect</label><div class="sk-toggleable__content"><pre>WeibullAdstockEffect(concentration_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x7ff249e0c790 with batch shape () and event shape ()&gt;,
                     scale_prior=&lt;numpyro.distributions.continuous.HalfNormal object at 0x7ff28c725a90 with batch shape () and event shape ()&gt;)</pre></div></div></div></div></div></div></div>
</div>
</div>
<div id="e2e892b7" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plot_prior_predictive(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    mm_saturation,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    X<span class="op">=</span>X[[<span class="st">"ad_spend_search"</span>]],</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    mode<span class="op">=</span><span class="st">"ad_spend_search"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    matplotlib_kwargs<span class="op">=</span><span class="bu">dict</span>(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">3</span>)),</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="saturation_and_adstock_files/figure-html/cell-12-output-1.png" width="489" height="259" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="extra-visualizing-the-impulse-response-of-adstock" class="level2">
<h2 class="anchored" data-anchor-id="extra-visualizing-the-impulse-response-of-adstock">Extra: Visualizing the impulse response of adstock</h2>
<p>The impulse response is one of the clearest ways to understand what adstock is doing.<br>
By feeding in a single one-day spike of spend (an <strong>impulse</strong>), we can isolate the effect of the adstock transformation without confounding from the full time series.</p>
<ul>
<li><strong>Isolates carryover</strong> ‚Üí shows exactly how much of today‚Äôs spend impacts tomorrow and the following days.<br>
</li>
<li><strong>Builds intuition</strong> ‚Üí a short tail means fast decay; a long tail means the campaign keeps influencing for weeks.<br>
</li>
<li><strong>Compares models</strong> ‚Üí geometric adstock has an exponential-like drop, while Weibull can flexibly capture rises before decay.<br>
</li>
<li><strong>Business meaning</strong> ‚Üí directly answers <em>‚ÄúIf I invest 1 unit today, what incremental impact should I expect tomorrow, next week, and beyond?‚Äù</em></li>
</ul>
<p>In short, the impulse response is the ‚Äúfingerprint‚Äù of an adstock model ‚Äî it makes lag and memory structures visible and interpretable.</p>
<div id="e71890c5" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_impulse_response(adstock):</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    X_impulse <span class="op">=</span> pd.DataFrame(</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        index<span class="op">=</span>pd.period_range(start<span class="op">=</span><span class="st">"2021-01-01"</span>, periods<span class="op">=</span><span class="dv">100</span>, freq<span class="op">=</span><span class="st">"D"</span>),</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>[<span class="dv">0</span>] <span class="op">*</span> <span class="dv">50</span> <span class="op">+</span> [<span class="dv">1</span>] <span class="op">+</span> [<span class="dv">0</span>] <span class="op">*</span> <span class="dv">49</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ).astype(<span class="bu">float</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plot_prior_predictive(</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        adstock,</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>        X<span class="op">=</span>X_impulse,</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>        mode<span class="op">=</span><span class="st">"time"</span>,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        matplotlib_kwargs<span class="op">=</span><span class="bu">dict</span>(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">3</span>)),</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    X_impulse.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">"tab:orange"</span>)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> line, label <span class="kw">in</span> <span class="bu">zip</span>(ax.lines, [<span class="st">"After Adstock"</span>, <span class="st">"Input Data"</span>]):</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>        line.set_label(label)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    ax.legend()</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    fig.show()</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>adstock <span class="op">=</span> GeometricAdstockEffect(</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    decay_prior<span class="op">=</span>dist.Delta(<span class="fl">0.7</span>),</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    normalize<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>plot_impulse_response(adstock)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="saturation_and_adstock_files/figure-html/cell-13-output-1.png" width="511" height="265" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>And for Weibull Adstock:</p>
<div id="278d5ac1" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>adstock <span class="op">=</span> WeibullAdstockEffect(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    scale_prior<span class="op">=</span>dist.Delta(<span class="dv">5</span>),</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    concentration_prior<span class="op">=</span>dist.Delta(<span class="fl">1.5</span>),</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>plot_impulse_response(adstock)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="saturation_and_adstock_files/figure-html/cell-14-output-1.png" width="511" height="265" class="figure-img"></p>
</figure>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>